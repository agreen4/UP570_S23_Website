<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Neighborhood Analysis - Place Opportunity</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Neighborhood Analysis</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../syllabus/index.html">
 <span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../schedule/index.html">
 <span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../assignments/index.html">
 <span class="menu-text">Assignments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../howto/index.html">
 <span class="menu-text">How To</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources/index.html">
 <span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://up570s23.slack.com/"><i class="bi bi-slack" role="img" aria-label="Slack">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#goals" id="toc-goals" class="nav-link" data-scroll-target="#goals">Goals</a></li>
  <li><a href="#core-concepts" id="toc-core-concepts" class="nav-link" data-scroll-target="#core-concepts">Core Concepts</a>
  <ul>
  <li><a href="#r-and-rstudio" id="toc-r-and-rstudio" class="nav-link" data-scroll-target="#r-and-rstudio">R and Rstudio</a></li>
  </ul></li>
  <li><a href="#github-lab-repository" id="toc-github-lab-repository" class="nav-link" data-scroll-target="#github-lab-repository">Github Lab Repository</a></li>
  <li><a href="#download-and-prepare-data-for-opportunity-mapping" id="toc-download-and-prepare-data-for-opportunity-mapping" class="nav-link" data-scroll-target="#download-and-prepare-data-for-opportunity-mapping">Download and Prepare Data for Opportunity Mapping</a>
  <ul>
  <li><a href="#acs-data" id="toc-acs-data" class="nav-link" data-scroll-target="#acs-data">ACS Data</a>
  <ul class="collapse">
  <li><a href="#join-acs-data" id="toc-join-acs-data" class="nav-link" data-scroll-target="#join-acs-data">Join ACS Data</a></li>
  </ul></li>
  <li><a href="#lai-data" id="toc-lai-data" class="nav-link" data-scroll-target="#lai-data">LAI Data</a></li>
  <li><a href="#ejscreen-data" id="toc-ejscreen-data" class="nav-link" data-scroll-target="#ejscreen-data">EJSCREEN Data</a></li>
  </ul></li>
  <li><a href="#joining-the-three-datasets" id="toc-joining-the-three-datasets" class="nav-link" data-scroll-target="#joining-the-three-datasets">Joining the Three Datasets</a>
  <ul>
  <li><a href="#creating-tract-data-from-block-groups" id="toc-creating-tract-data-from-block-groups" class="nav-link" data-scroll-target="#creating-tract-data-from-block-groups">Creating Tract Data from Block Groups</a></li>
  </ul></li>
  <li><a href="#create-standardized-scores" id="toc-create-standardized-scores" class="nav-link" data-scroll-target="#create-standardized-scores">Create Standardized Scores</a></li>
  <li><a href="#visualizing-index-values" id="toc-visualizing-index-values" class="nav-link" data-scroll-target="#visualizing-index-values">Visualizing Index Values</a></li>
  <li><a href="#demographics-by-opportunity-levels" id="toc-demographics-by-opportunity-levels" class="nav-link" data-scroll-target="#demographics-by-opportunity-levels">Demographics by Opportunity Levels</a></li>
  <li><a href="#how-different-are-counties-in-the-region" id="toc-how-different-are-counties-in-the-region" class="nav-link" data-scroll-target="#how-different-are-counties-in-the-region">How different are counties in the region?</a>
  <ul>
  <li><a href="#extending-your-analysis" id="toc-extending-your-analysis" class="nav-link" data-scroll-target="#extending-your-analysis">Extending your Analysis</a></li>
  <li><a href="#lab-evaluation" id="toc-lab-evaluation" class="nav-link" data-scroll-target="#lab-evaluation">Lab Evaluation</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Place Opportunity</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i></button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-1_4c858ee0b1c50651b6bcd1f3ce7cb7f8">

</div>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In this lab, we’ll extend our knowledge of opportunity maps, and more generally in standardizing and creating indexes from data. This strategy is in some ways an extension of the strategy we used to measure neighborhood change. Our measurement of neighborhood change, however, focused on a single dimension of change - income. In this case, we’ll produce a <em>multidimensional</em> measure of change.</p>
<p>As we have discussed in class, opportunity maps and other indexes are commonly used to be able to illustrate the distribution of resources across space and over time. These types of indexes are designed to be <em>multidimensional</em>, and therefore require a strong theoretical framework connecting concepts related to opportunity to indicators or measures designed to proxy or represent these concepts.</p>
</section>
<section id="goals" class="level2">
<h2 class="anchored" data-anchor-id="goals">Goals</h2>
<p>This lab introduces you to the following: - Common methods for standardizing and constructing indexes from demographic data - Basic concepts associated with relational joins between datasets - Reinforces and provides a means of practicing data visualization and presentation</p>
</section>
<section id="core-concepts" class="level2">
<h2 class="anchored" data-anchor-id="core-concepts">Core Concepts</h2>
<section id="r-and-rstudio" class="level3">
<h3 class="anchored" data-anchor-id="r-and-rstudio">R and Rstudio</h3>
<ul>
<li><code>across()</code></li>
<li><code>reduce()</code></li>
<li><code>rowwise()</code></li>
<li><code>scale()</code></li>
</ul>
<p>Let’s get going…</p>
</section>
</section>
<section id="github-lab-repository" class="level2">
<h2 class="anchored" data-anchor-id="github-lab-repository">Github Lab Repository</h2>
<p>If you have not already done so, follow <a href="https://classroom.github.com/a/VQuhogi7">this link</a> to accept the lab Github Classroom assignment repository.</p>
</section>
<section id="download-and-prepare-data-for-opportunity-mapping" class="level2">
<h2 class="anchored" data-anchor-id="download-and-prepare-data-for-opportunity-mapping">Download and Prepare Data for Opportunity Mapping</h2>
<p>The <a href="https://uofi.box.com/s/icccjttbig4mq94nbi123b6x3o33a4zi">National Housing Conference brief</a> which you read for Tuesday outlines several suggested data sources for opportunity mapping. For the purpose of learning some of the methods associated with opportunity mapping, we’ll work with three primary data sources:</p>
<ul>
<li><a href="http://www.data.census.gov">U.S. Census Bureau - American Community Survey</a></li>
<li><a href="https://hudgis-hud.opendata.arcgis.com/datasets/location-affordability-index-v-3">HUD Location Affordability Index (version 3.0)</a></li>
<li><a href="https://www.epa.gov/ejscreen/download-ejscreen-data">EPA EJSCREEN</a></li>
</ul>
<p>You should independently explore the documentation for these datasets and their indicators - there is a treasure trove of documentation to look at. When possible, download data documentation to your docuemtnation project folder.</p>
<p>We’ll divide these data into a few conceptual categories commonly seen in opportunity maps: - Education - Housing Characteristics - Social Capital - Public Health and Safety - Employment and Workforce - Transportation and Mobility</p>
<table class="table">
<thead>
<tr class="header">
<th>Category</th>
<th>Indicator</th>
<th>Data Source</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Education</td>
<td>Population with a High School Diploma or greater</td>
<td><a href="https://data.census.gov">ACS</a></td>
</tr>
<tr class="even">
<td>Education</td>
<td>Population with a Bachelor’s Degree or greater</td>
<td><a href="https://data.census.gov">ACS</a></td>
</tr>
<tr class="odd">
<td>Housing Characteristics</td>
<td>Median Home Value</td>
<td><a href="https://data.census.gov">ACS</a></td>
</tr>
<tr class="even">
<td>Housing Characteristics</td>
<td>Median Gross Rent</td>
<td><a href="https://hudgis-hud.opendata.arcgis.com/datasets/location-affordability-index-v-3">HUD LAI</a></td>
</tr>
<tr class="odd">
<td>Housing Characteristics</td>
<td>Percentage Single Family Housing Units</td>
<td><a href="https://hudgis-hud.opendata.arcgis.com/datasets/location-affordability-index-v-3">HUD LAI</a></td>
</tr>
<tr class="even">
<td>Housing Characteristics</td>
<td>Gross Rent as Percentage of Income</td>
<td><a href="https://data.census.gov">ACS</a></td>
</tr>
<tr class="odd">
<td>Housing Characteristics</td>
<td>Housing Cost Burden</td>
<td><a href="https://data.census.gov">ACS</a></td>
</tr>
<tr class="even">
<td>Housing Characteristics</td>
<td>Residential Vacancy Rate</td>
<td><a href="https://data.census.gov">ACS</a></td>
</tr>
<tr class="odd">
<td>Social Capital</td>
<td>Population Age 25 - 44</td>
<td><a href="https://data.census.gov">ACS</a></td>
</tr>
<tr class="even">
<td>Social Capital</td>
<td>Median Household Income</td>
<td><a href="https://data.census.gov">ACS</a></td>
</tr>
<tr class="odd">
<td>Social Capital</td>
<td>Percent of Households in Poverty</td>
<td><a href="https://data.census.gov">ACS</a></td>
</tr>
<tr class="even">
<td>Social Capital</td>
<td>Percentage of Owner-Occupied Housing Units</td>
<td><a href="https://data.census.gov">ACS</a></td>
</tr>
<tr class="odd">
<td>Employment and Worforce</td>
<td>Job Density</td>
<td><a href="https://hudgis-hud.opendata.arcgis.com/datasets/location-affordability-index-v-3">HUD LAI</a></td>
</tr>
<tr class="even">
<td>Employment and Worforce</td>
<td>Retail Density</td>
<td><a href="https://hudgis-hud.opendata.arcgis.com/datasets/location-affordability-index-v-3">HUD LAI</a></td>
</tr>
<tr class="odd">
<td>Transportation and Mobility</td>
<td>Median Commute Time</td>
<td><a href="https://hudgis-hud.opendata.arcgis.com/datasets/location-affordability-index-v-3">HUD LAI</a></td>
</tr>
<tr class="even">
<td>Transportation and Mobility</td>
<td>Public Transit Use (Journey to work)</td>
<td><a href="https://hudgis-hud.opendata.arcgis.com/datasets/location-affordability-index-v-3">HUD LAI</a></td>
</tr>
<tr class="odd">
<td>Public Health and Safety</td>
<td>NATA Cancer Risk Index</td>
<td><a href="https://www.epa.gov/ejscreen/download-ejscreen-data">EPA EJSCREEN (2022)</a></td>
</tr>
<tr class="even">
<td>Public Health and Safety</td>
<td>NATA Respiratory Hazard Index</td>
<td><a href="https://www.epa.gov/ejscreen/download-ejscreen-data">EPA EJSCREEN (2022)</a></td>
</tr>
<tr class="odd">
<td>Public Health and Safety</td>
<td>Traffic Proximity and Volume</td>
<td><a href="https://www.epa.gov/ejscreen/download-ejscreen-data">EPA EJSCREEN (2022)</a></td>
</tr>
<tr class="even">
<td>Public Health and Safety</td>
<td>Particulate Matter</td>
<td><a href="https://www.epa.gov/ejscreen/download-ejscreen-data">EPA EJSCREEN(2022)</a></td>
</tr>
</tbody>
</table>
<p>I have provided download links for the EJSCREEN and LAI data. We will use <code>tidycensus</code> to load ACS data.</p>
<section id="acs-data" class="level3">
<h3 class="anchored" data-anchor-id="acs-data">ACS Data</h3>
<p>Let’s start by loading some ACS data:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-2_b5ca105a1bb17d91af43e67b30558b60">

</div>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-3_33f6f8c5df7282724e6cd766ed172708">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>DL_Year<span class="ot">&lt;-</span><span class="dv">2020</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>survey <span class="ot">&lt;-</span> <span class="st">"acs5"</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>state<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"NY"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"scripts/1_Get_ACS.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This should look familiar - we have a script kept in the scripts folder with general code to download selected variables from the American Community Survey. Rather than placing this code in our notebook, we can use the <code>source()</code> command to run the script in its entirety. We are defining the variables (api_key, DL_Year, survey, state) in our notebook, so that these can be referenced when the script is running.</p>
<p>We have downloaded a lot of ACS data here at the census tract level for all tracts in Illinois:</p>
<table class="table">
<thead>
<tr class="header">
<th>Table</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>B01001</td>
<td>Age and Population</td>
</tr>
<tr class="even">
<td>B02001</td>
<td>Race</td>
</tr>
<tr class="odd">
<td>B03001</td>
<td>Ethnicity</td>
</tr>
<tr class="even">
<td>B05002</td>
<td>Foreign Born</td>
</tr>
<tr class="odd">
<td>B11001</td>
<td>Female Headed Household</td>
</tr>
<tr class="even">
<td>B17001</td>
<td>Poverty Rate</td>
</tr>
<tr class="odd">
<td>B19013</td>
<td>Median Household Income</td>
</tr>
<tr class="even">
<td>B25002</td>
<td>Residential Vacancy</td>
</tr>
<tr class="odd">
<td>B25003</td>
<td>Housing Tenure</td>
</tr>
<tr class="even">
<td>B25077</td>
<td>Median Home Value</td>
</tr>
<tr class="odd">
<td>B25106</td>
<td>Housing Cost Burden</td>
</tr>
</tbody>
</table>
<p>I went ahead and turned this raw data into some selected indicators:</p>
<table class="table">
<colgroup>
<col style="width: 24%">
<col style="width: 24%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Table</th>
<th>Label</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>B01001</td>
<td>under18</td>
<td>Proportion of Population under 18</td>
</tr>
<tr class="even">
<td>B01001</td>
<td>over65</td>
<td>Proportion of Population over 65</td>
</tr>
<tr class="odd">
<td>B01001</td>
<td>P_Female</td>
<td>Proportion of Population female</td>
</tr>
<tr class="even">
<td>B01001</td>
<td>Pop</td>
<td>Total Population size</td>
</tr>
<tr class="odd">
<td>B02001</td>
<td>PWhite</td>
<td>Proportion Population White</td>
</tr>
<tr class="even">
<td>B02001</td>
<td>PBlack</td>
<td>Proportion Population Black</td>
</tr>
<tr class="odd">
<td>B02001</td>
<td>PAIAN</td>
<td>Proportion Population AIAN</td>
</tr>
<tr class="even">
<td>B02001</td>
<td>PAsian</td>
<td>Proportion Population Asian</td>
</tr>
<tr class="odd">
<td>B02001</td>
<td>PNonwhite</td>
<td>Proportion Population Nonwhite</td>
</tr>
<tr class="even">
<td>B03001</td>
<td>PLatino</td>
<td>Proportion Population Latino Ethnicity (Of all Races)</td>
</tr>
<tr class="odd">
<td>B05002</td>
<td>PForeignborn</td>
<td>Proportion Population Foreign Born</td>
</tr>
<tr class="even">
<td>B19013</td>
<td>MHHI</td>
<td>Median Household Income</td>
</tr>
<tr class="odd">
<td>B11001</td>
<td>P_FHHH</td>
<td>Proportion Female Headed Households</td>
</tr>
<tr class="even">
<td>B17001</td>
<td>Pov</td>
<td>Proportion Households Below Poverty</td>
</tr>
<tr class="odd">
<td>B25003</td>
<td>P_Own</td>
<td>Proportion Owner Occupied Housing Units</td>
</tr>
<tr class="even">
<td>B25077</td>
<td>MHV</td>
<td>Median Home Value</td>
</tr>
<tr class="odd">
<td>B25106</td>
<td>CostBurden</td>
<td>Housing Cost Burden</td>
</tr>
<tr class="even">
<td>B25002</td>
<td>Rvac</td>
<td>Residential Vacancy Rate</td>
</tr>
</tbody>
</table>
<section id="join-acs-data" class="level4">
<h4 class="anchored" data-anchor-id="join-acs-data">Join ACS Data</h4>
<p>Now that we have these individual tables downloaded, we need to combine these together into a single dataset. We’ve done this many times in the past using <code>left_join()</code> but only with respect to two datasets at a time. Let’s introduce an alternative strategy here, using the purrr package’s <code>reduce()</code> function combined with <code>left_join()</code>.</p>
<p>First, here’s the way we might accomplish this as we have in the past:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-4_3a25458ae3b4ef86a8626697531a65c8">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>acs_data<span class="ot">&lt;-</span><span class="fu">left_join</span>(B01001, B02001, <span class="at">by=</span><span class="st">"GEOID"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>acs_data<span class="ot">&lt;-</span><span class="fu">left_join</span>(acs_data, B03001, <span class="at">by=</span><span class="st">"GEOID"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>acs_data<span class="ot">&lt;-</span><span class="fu">left_join</span>(acs_data, B05002, <span class="at">by=</span><span class="st">"GEOID"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>acs_data<span class="ot">&lt;-</span><span class="fu">left_join</span>(acs_data, B11001, <span class="at">by=</span><span class="st">"GEOID"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>acs_data<span class="ot">&lt;-</span><span class="fu">left_join</span>(acs_data, B17001, <span class="at">by=</span><span class="st">"GEOID"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>acs_data<span class="ot">&lt;-</span><span class="fu">left_join</span>(acs_data, B19013, <span class="at">by=</span><span class="st">"GEOID"</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>acs_data<span class="ot">&lt;-</span><span class="fu">left_join</span>(acs_data, B25002, <span class="at">by=</span><span class="st">"GEOID"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>acs_data<span class="ot">&lt;-</span><span class="fu">left_join</span>(acs_data, B25003, <span class="at">by=</span><span class="st">"GEOID"</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>acs_data<span class="ot">&lt;-</span><span class="fu">left_join</span>(acs_data, B25077, <span class="at">by=</span><span class="st">"GEOID"</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>acs_data<span class="ot">&lt;-</span><span class="fu">left_join</span>(acs_data, B25106, <span class="at">by=</span><span class="st">"GEOID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This works just fine, but there’s a lot of repition of code here with so many data frames.</p>
<p>Now let’s look at how we can implement the same thing using <code>reduce()</code>:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-5_d0e9fc7e19feb13f58c0c0408123c12f">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>acs_data <span class="ot">&lt;-</span> <span class="fu">list</span>(B01001, B02001, B03001, B05002, B11001, B17001, B19013, B25002, B25003, B25077, B25106) <span class="sc">|&gt;</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(left_join, <span class="at">by =</span> <span class="st">"GEOID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In this case, we create a list containing each of the data frames we want to join together (note that we don’t put these in quotes since they’re objects and not names). We then use the <code>reduce()</code> command and tell reduce that we want to perform a left join and also supply the common variable name.</p>
<p>But what is <code>reduce()</code> really doing here? If you look at it’s documentation (<code>?reduce</code>), you’ll see that:</p>
<p><code>reduce()</code> is an operation that combines elements of a vector into a single value. The combination is driven by .f, a binary function, and takes two values and returns a single value: Reducing f over 1:3 computes the values f(f(1,2), 3).</p>
<p>So if we are doing a left join, this is essentially doing the following:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-6_650d57741778eca9f2365b463548c232">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>acs_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(df1, df2)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>acs_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(acs_data, df3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And on and on until reduce has iterated through all elements of the list. This helps us cut down on repititious code.</p>
<p>Inspecting our handiwork, our acs_data table (for which we downloaded tract-level data for New York state has 5,411 observations and 19 variables:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-7_a3c95cb8dac989523d8beb179cf75fca">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(acs_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [5,411 × 19] (S3: tbl_df/tbl/data.frame)
 $ GEOID       : chr [1:5411] "36011040600" "36011040700" "36011040800" "36011040900" ...
 $ under18     : num [1:5411] 0.183 0.187 0.192 0.218 0.2 ...
 $ over65      : num [1:5411] 0.234 0.216 0.182 0.18 0.165 ...
 $ Pop         : num [1:5411] 3400 3633 4668 3683 3088 ...
 $ P_Female    : num [1:5411] 0.504 0.518 0.419 0.476 0.456 ...
 $ PWhite      : num [1:5411] 0.945 0.978 0.841 0.982 0.94 ...
 $ PBlack      : num [1:5411] 0.037647 0 0.113325 0.000272 0 ...
 $ PAIAN       : num [1:5411] 0 0 0 0.000815 0.000324 ...
 $ PAsian      : num [1:5411] 0.00235 0 0.00771 0.00434 0.0068 ...
 $ PNonwhite   : num [1:5411] 0.0547 0.022 0.1594 0.0185 0.0599 ...
 $ PLatino     : num [1:5411] 0.01647 0.00798 0.02571 0.02607 0.04955 ...
 $ PForeignborn: num [1:5411] 0.0176 0.0242 0.0176 0.0141 0.0385 ...
 $ P_FHHH      : num [1:5411] 0.0931 0.0486 0.089 0.0989 0.0638 ...
 $ Pov         : num [1:5411] 0.0507 0.049 0.0991 0.158 0.087 ...
 $ MHHI        : num [1:5411] 84330 93493 64811 66711 73182 ...
 $ Rvac        : num [1:5411] 0.0898 0.1612 0.3182 0.176 0.246 ...
 $ P_Own       : num [1:5411] 0.917 0.935 0.828 0.872 0.836 ...
 $ MHV         : num [1:5411] 186500 174900 147100 142700 147600 ...
 $ CostBurden  : num [1:5411] 0.224 0.206 0.283 0.246 0.172 ...</code></pre>
</div>
</div>
<p>While we’re at it, let’s do a little cleaning up. We have a lot of data frames which are now consolidated into acs_data. We can delete other objects from our environment using <code>rm()</code></p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-8_a32adf53d5a75645ad3e428210c928bb">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(B01001, B02001, B03001, B05002, B11001, B17001, B19013, B25002, B25003, B25077, B25106)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="lai-data" class="level3">
<h3 class="anchored" data-anchor-id="lai-data">LAI Data</h3>
<p>Let’s download the HUD LAI data from <a href="https://opendata.arcgis.com/datasets/b7ffe3607e8c4212bf7cf2428208dbb6_0.csv">here</a>. Readr can read this directly from the download URL:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-9_403294839729b117e6955d54c763b256">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>LAI <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://opendata.arcgis.com/datasets/b7ffe3607e8c4212bf7cf2428208dbb6_0.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 73763 Columns: 444
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr   (7): GEOID, STATE, COUNTY, TRACT, CNTY_FIPS, STUSAB, area_type
dbl (437): OBJECTID, households, owner_occupied_hu, renter_occupied_hu, pct_...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>Let’s go ahead and select the following variables (our variables of interest) and overwrite the initial file:</p>
<ul>
<li>GEOID</li>
<li>pct_transit_j2w</li>
<li>median_gross_rent</li>
<li>pct_hu_1_detatched</li>
<li>job_density_simple</li>
<li>retail_density_simple</li>
<li>median_commute</li>
</ul>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-10_c5109cdb319273829ae89657e31add40">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>LAI<span class="ot">&lt;-</span>LAI <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                    STUSAB,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                    pct_transit_j2w,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                    median_gross_rent,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                    pct_hu_1_detached,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                    job_density_simple,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                    retail_density_simple,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                    median_commute</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="ejscreen-data" class="level3">
<h3 class="anchored" data-anchor-id="ejscreen-data">EJSCREEN Data</h3>
<p>We can download the EJSCREEN data <a href="https://gaftp.epa.gov/EJSCREEN/2020/">here</a>. Unlike the LAI data which we could read directly from the .csv file, the EJSCREEN data will need to be downloaded and unzipped before it can be used.</p>
<p>We’ll use the <code>read_csv()</code> function from the <code>readr</code> package to load raw EJSCREEN data, located in the “data” folder. Load these into an object called “ejscreen”:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-11_c84188589a056003d9c452150048eb32">

</div>
<p>Inspect the data. Let’s select a subset of the variables in the data which we’ll work more with. Based upon our framework, we’ll select the following variables and overwrite the original ejscreen object with our selection:</p>
<ul>
<li>ID</li>
<li>ACSTOTPOP</li>
<li>CANCER</li>
<li>RESP</li>
<li>PTRAF</li>
<li>PM25</li>
</ul>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-12_1f4c40271b99dbc9e49a4b1ffe56028c">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>ejscreen<span class="ot">&lt;-</span>ejscreen <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>        ACSTOTPOP,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        CANCER,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        RESP,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        PTRAF,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        PM25)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="joining-the-three-datasets" class="level2">
<h2 class="anchored" data-anchor-id="joining-the-three-datasets">Joining the Three Datasets</h2>
<p>Ok - we’re getting somewhere, I promise! We now have three datasets - acs_data, which contains tract-level data for New York state, LAI which contains <em>tract-level data</em> for the entire US, and ejscreen which contains <em>block group level data</em> for the US. We’re so close to joining these together and indexing the data!</p>
<section id="creating-tract-data-from-block-groups" class="level3">
<h3 class="anchored" data-anchor-id="creating-tract-data-from-block-groups">Creating Tract Data from Block Groups</h3>
<p>One thing, though - we need to convert our ejscreen block groups data into tracts. Block groups are geographic subdivisions of tracts. Fortunately for us, Census FIPS codes are hierarchical - the combined state-county-tract-blockgroup variable called “ID” in ejscreen contains the tract FIPS code: - State (2 characters) - County (3 characters) - Tract (6 characters) - Block Group (1 character)</p>
<p>Ok, this is all well and good - how do we use this knowledge to combine things together? We could simply average the block group values together to approximate a tract-level average. At the same time, block groups are likely to have different populations. Given this potential heterogeneity, let’s use the population weighted average of those block group characteristics to constitute our tract characteristics.</p>
<p>To aggregate our block group data, we need to extract the tract characters from the ID column, and then we can <code>group_by()</code> and <code>summarise</code> our data based upon the tract FIPS code. Base R fortunately has a function called <code>substr()</code> (substring) which can handle the extraction for us:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-13_38ce2b574d4e73368579c6bed8052873">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ejscreen<span class="ot">&lt;-</span>ejscreen <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">GEOID =</span> <span class="fu">substr</span>(ID, <span class="dv">0</span>, <span class="dv">11</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>What happened here? We’re creating a new column called GEOID, and then invoking substr. We tell that function that we want a substring from the ID field, and then we say 0, 11, where 0 is the first position if we were counting from the left of the first character in the ID variable, and 11 is the last character that we want (remember, the combined FIPS code is 12 characters long, and we want all but the last character).</p>
<p>And now we can use <code>group_by()</code> and <code>summarise()</code> to group together the data into census tract level aggregates. We can use <code>weighted.mean()</code> to calculate… weight for it… the weighted average (professor humor)! GEOID contains our combined state-county-tract FIPS code, ACSTOTPOP contains out population for the purpose of weighting, and we want to calculate averages for CANCER, RESP, PTRAF, and PM25. Figure out how to get that done.</p>
<p>Sneak preview - you’re going to hit an error - think about what rows might need to be removed to calculate a weighted average:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-14_c7be02f1087b6005a04cceb2040b9fb1">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ejscreen<span class="ot">&lt;-</span>ejscreen <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ACSTOTPOP <span class="sc">!=</span> <span class="dv">0</span>, CANCER <span class="sc">!=</span> <span class="st">"None"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID) <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">CANCER =</span> <span class="fu">weighted.mean</span>(<span class="fu">as.numeric</span>(CANCER), ACSTOTPOP),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">RESP =</span> <span class="fu">weighted.mean</span>(<span class="fu">as.numeric</span>(RESP), ACSTOTPOP),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">PTRAF =</span> <span class="fu">weighted.mean</span>(PTRAF, ACSTOTPOP),</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">PM25 =</span> <span class="fu">weighted.mean</span>(<span class="fu">as.numeric</span>(PM25), ACSTOTPOP))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Ok - now we have around 73,000 tract-level observations for the EPA data - not too far off from what we have for the LAI data. Both of these datasets include observations for the entire US, while our ACS data only contains observations for New York State. Using your newfound knowledge of how to join data together based upon a common column, create a new object named dataset which contains combined ACS, ejscreen, and LAI data for Illinois census tracts:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-15_cd567b8308dd640e351e37f29134790c">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>dataset<span class="ot">&lt;-</span> <span class="fu">list</span>(acs_data,  LAI, ejscreen) <span class="sc">|&gt;</span> <span class="fu">reduce</span>(left_join, <span class="at">by=</span><span class="st">"GEOID"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>dataset <span class="sc">|&gt;</span> <span class="fu">head</span>() <span class="sc">|&gt;</span> <span class="fu">gt</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="ugmrabvqqo" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

:where(#ugmrabvqqo) .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

:where(#ugmrabvqqo) .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#ugmrabvqqo) .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

:where(#ugmrabvqqo) .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

:where(#ugmrabvqqo) .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#ugmrabvqqo) .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#ugmrabvqqo) .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

:where(#ugmrabvqqo) .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

:where(#ugmrabvqqo) .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

:where(#ugmrabvqqo) .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

:where(#ugmrabvqqo) .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

:where(#ugmrabvqqo) .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

:where(#ugmrabvqqo) .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

:where(#ugmrabvqqo) .gt_from_md > :first-child {
  margin-top: 0;
}

:where(#ugmrabvqqo) .gt_from_md > :last-child {
  margin-bottom: 0;
}

:where(#ugmrabvqqo) .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

:where(#ugmrabvqqo) .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#ugmrabvqqo) .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

:where(#ugmrabvqqo) .gt_row_group_first td {
  border-top-width: 2px;
}

:where(#ugmrabvqqo) .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#ugmrabvqqo) .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

:where(#ugmrabvqqo) .gt_first_summary_row.thick {
  border-top-width: 2px;
}

:where(#ugmrabvqqo) .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#ugmrabvqqo) .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#ugmrabvqqo) .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

:where(#ugmrabvqqo) .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

:where(#ugmrabvqqo) .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#ugmrabvqqo) .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#ugmrabvqqo) .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#ugmrabvqqo) .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#ugmrabvqqo) .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#ugmrabvqqo) .gt_left {
  text-align: left;
}

:where(#ugmrabvqqo) .gt_center {
  text-align: center;
}

:where(#ugmrabvqqo) .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

:where(#ugmrabvqqo) .gt_font_normal {
  font-weight: normal;
}

:where(#ugmrabvqqo) .gt_font_bold {
  font-weight: bold;
}

:where(#ugmrabvqqo) .gt_font_italic {
  font-style: italic;
}

:where(#ugmrabvqqo) .gt_super {
  font-size: 65%;
}

:where(#ugmrabvqqo) .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

:where(#ugmrabvqqo) .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

:where(#ugmrabvqqo) .gt_indent_1 {
  text-indent: 5px;
}

:where(#ugmrabvqqo) .gt_indent_2 {
  text-indent: 10px;
}

:where(#ugmrabvqqo) .gt_indent_3 {
  text-indent: 15px;
}

:where(#ugmrabvqqo) .gt_indent_4 {
  text-indent: 20px;
}

:where(#ugmrabvqqo) .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">GEOID</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">under18</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">over65</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">Pop</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">P_Female</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">PWhite</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">PBlack</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">PAIAN</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">PAsian</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">PNonwhite</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">PLatino</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">PForeignborn</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">P_FHHH</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">Pov</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">MHHI</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">Rvac</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">P_Own</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">MHV</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">CostBurden</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">STUSAB</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">pct_transit_j2w</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">median_gross_rent</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">pct_hu_1_detached</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">job_density_simple</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">retail_density_simple</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">median_commute</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">CANCER</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">RESP</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">PTRAF</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">PM25</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right">36011040600</td>
<td class="gt_row gt_right">0.1829412</td>
<td class="gt_row gt_right">0.2341176</td>
<td class="gt_row gt_right">3400</td>
<td class="gt_row gt_right">0.5044118</td>
<td class="gt_row gt_right">0.9452941</td>
<td class="gt_row gt_right">0.0376470588</td>
<td class="gt_row gt_right">0.0000000000</td>
<td class="gt_row gt_right">0.002352941</td>
<td class="gt_row gt_right">0.05470588</td>
<td class="gt_row gt_right">0.016470588</td>
<td class="gt_row gt_right">0.01764706</td>
<td class="gt_row gt_right">0.09307876</td>
<td class="gt_row gt_right">0.05068672</td>
<td class="gt_row gt_right">84330</td>
<td class="gt_row gt_right">0.08979001</td>
<td class="gt_row gt_right">0.9172633</td>
<td class="gt_row gt_right">186500</td>
<td class="gt_row gt_right">0.2235481</td>
<td class="gt_row gt_left">NY</td>
<td class="gt_row gt_right">0.7344093</td>
<td class="gt_row gt_right">869</td>
<td class="gt_row gt_right">92.82640</td>
<td class="gt_row gt_right">0.071023683</td>
<td class="gt_row gt_right">0.006993935</td>
<td class="gt_row gt_right">16.00</td>
<td class="gt_row gt_right">19.70603</td>
<td class="gt_row gt_right">0.2238431</td>
<td class="gt_row gt_right">76.199249</td>
<td class="gt_row gt_right">6.211746</td></tr>
    <tr><td class="gt_row gt_right">36011040700</td>
<td class="gt_row gt_right">0.1871731</td>
<td class="gt_row gt_right">0.2163501</td>
<td class="gt_row gt_right">3633</td>
<td class="gt_row gt_right">0.5183044</td>
<td class="gt_row gt_right">0.9779796</td>
<td class="gt_row gt_right">0.0000000000</td>
<td class="gt_row gt_right">0.0000000000</td>
<td class="gt_row gt_right">0.000000000</td>
<td class="gt_row gt_right">0.02202037</td>
<td class="gt_row gt_right">0.007982384</td>
<td class="gt_row gt_right">0.02422241</td>
<td class="gt_row gt_right">0.04855024</td>
<td class="gt_row gt_right">0.04899532</td>
<td class="gt_row gt_right">93493</td>
<td class="gt_row gt_right">0.16119910</td>
<td class="gt_row gt_right">0.9352664</td>
<td class="gt_row gt_right">174900</td>
<td class="gt_row gt_right">0.2063385</td>
<td class="gt_row gt_left">NY</td>
<td class="gt_row gt_right">0.0000000</td>
<td class="gt_row gt_right">787</td>
<td class="gt_row gt_right">94.71613</td>
<td class="gt_row gt_right">0.084031686</td>
<td class="gt_row gt_right">0.000897934</td>
<td class="gt_row gt_right">13.95</td>
<td class="gt_row gt_right">19.58912</td>
<td class="gt_row gt_right">0.2248577</td>
<td class="gt_row gt_right">8.835063</td>
<td class="gt_row gt_right">6.179412</td></tr>
    <tr><td class="gt_row gt_right">36011040800</td>
<td class="gt_row gt_right">0.1919452</td>
<td class="gt_row gt_right">0.1820908</td>
<td class="gt_row gt_right">4668</td>
<td class="gt_row gt_right">0.4190231</td>
<td class="gt_row gt_right">0.8406170</td>
<td class="gt_row gt_right">0.1133247644</td>
<td class="gt_row gt_right">0.0000000000</td>
<td class="gt_row gt_right">0.007712082</td>
<td class="gt_row gt_right">0.15938303</td>
<td class="gt_row gt_right">0.025706941</td>
<td class="gt_row gt_right">0.01756641</td>
<td class="gt_row gt_right">0.08900524</td>
<td class="gt_row gt_right">0.09908915</td>
<td class="gt_row gt_right">64811</td>
<td class="gt_row gt_right">0.31816154</td>
<td class="gt_row gt_right">0.8278796</td>
<td class="gt_row gt_right">147100</td>
<td class="gt_row gt_right">0.2827225</td>
<td class="gt_row gt_left">NY</td>
<td class="gt_row gt_right">0.1046997</td>
<td class="gt_row gt_right">621</td>
<td class="gt_row gt_right">75.63869</td>
<td class="gt_row gt_right">0.021437169</td>
<td class="gt_row gt_right">0.003085479</td>
<td class="gt_row gt_right">20.63</td>
<td class="gt_row gt_right">17.56237</td>
<td class="gt_row gt_right">0.1972023</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">6.092557</td></tr>
    <tr><td class="gt_row gt_right">36011040900</td>
<td class="gt_row gt_right">0.2180288</td>
<td class="gt_row gt_right">0.1802878</td>
<td class="gt_row gt_right">3683</td>
<td class="gt_row gt_right">0.4759707</td>
<td class="gt_row gt_right">0.9815368</td>
<td class="gt_row gt_right">0.0002715178</td>
<td class="gt_row gt_right">0.0008145534</td>
<td class="gt_row gt_right">0.004344285</td>
<td class="gt_row gt_right">0.01846321</td>
<td class="gt_row gt_right">0.026065707</td>
<td class="gt_row gt_right">0.01411892</td>
<td class="gt_row gt_right">0.09890110</td>
<td class="gt_row gt_right">0.15799510</td>
<td class="gt_row gt_right">66711</td>
<td class="gt_row gt_right">0.17600453</td>
<td class="gt_row gt_right">0.8722527</td>
<td class="gt_row gt_right">142700</td>
<td class="gt_row gt_right">0.2458791</td>
<td class="gt_row gt_left">NY</td>
<td class="gt_row gt_right">0.1057314</td>
<td class="gt_row gt_right">733</td>
<td class="gt_row gt_right">70.25913</td>
<td class="gt_row gt_right">0.004264647</td>
<td class="gt_row gt_right">0.000176875</td>
<td class="gt_row gt_right">18.12</td>
<td class="gt_row gt_right">17.22243</td>
<td class="gt_row gt_right">0.1934044</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">6.108516</td></tr>
    <tr><td class="gt_row gt_right">36011041001</td>
<td class="gt_row gt_right">0.2001295</td>
<td class="gt_row gt_right">0.1648316</td>
<td class="gt_row gt_right">3088</td>
<td class="gt_row gt_right">0.4562824</td>
<td class="gt_row gt_right">0.9400907</td>
<td class="gt_row gt_right">0.0000000000</td>
<td class="gt_row gt_right">0.0003238342</td>
<td class="gt_row gt_right">0.006800518</td>
<td class="gt_row gt_right">0.05990933</td>
<td class="gt_row gt_right">0.049546632</td>
<td class="gt_row gt_right">0.03853627</td>
<td class="gt_row gt_right">0.06375839</td>
<td class="gt_row gt_right">0.08699902</td>
<td class="gt_row gt_right">73182</td>
<td class="gt_row gt_right">0.24604681</td>
<td class="gt_row gt_right">0.8355705</td>
<td class="gt_row gt_right">147600</td>
<td class="gt_row gt_right">0.1719799</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">NA</td></tr>
    <tr><td class="gt_row gt_right">36011041002</td>
<td class="gt_row gt_right">0.1115152</td>
<td class="gt_row gt_right">0.1921212</td>
<td class="gt_row gt_right">1650</td>
<td class="gt_row gt_right">0.4678788</td>
<td class="gt_row gt_right">0.8909091</td>
<td class="gt_row gt_right">0.0151515152</td>
<td class="gt_row gt_right">0.0042424242</td>
<td class="gt_row gt_right">0.013333333</td>
<td class="gt_row gt_right">0.10909091</td>
<td class="gt_row gt_right">0.065454545</td>
<td class="gt_row gt_right">0.02424242</td>
<td class="gt_row gt_right">0.04838710</td>
<td class="gt_row gt_right">0.09794239</td>
<td class="gt_row gt_right">79167</td>
<td class="gt_row gt_right">0.35416667</td>
<td class="gt_row gt_right">0.8440860</td>
<td class="gt_row gt_right">169900</td>
<td class="gt_row gt_right">0.1487455</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">NA</td>
<td class="gt_row gt_right">NA</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<p>Now that we have our base dataset together, we can filter to our area of interest, in this case, the boroughs that make up New York City:</p>
<table class="table">
<thead>
<tr class="header">
<th>FIPS Code</th>
<th>County Name</th>
<th>Borough Name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>36047</td>
<td>Kings County</td>
<td>Brooklyn</td>
</tr>
<tr class="even">
<td>36005</td>
<td>Bronx County</td>
<td>Bronx</td>
</tr>
<tr class="odd">
<td>36081</td>
<td>Queens County</td>
<td>Queens</td>
</tr>
<tr class="even">
<td>36085</td>
<td>Richmond County</td>
<td>Staten Island</td>
</tr>
<tr class="odd">
<td>36061</td>
<td>New York County</td>
<td>Manhattan</td>
</tr>
</tbody>
</table>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-16_72db480cc6ea1f7707b45b9d3a302940">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> dataset <span class="sc">|&gt;</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">substr</span>(GEOID, <span class="dv">0</span>, <span class="dv">5</span>) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"36047"</span>, <span class="st">"36005"</span>, <span class="st">"36081"</span>, <span class="st">"36085"</span>, <span class="st">"36061"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The above code uses <code>substr()</code> to pull out the first 5 characters from the GEOID field (the combined state and county FIPS codes) and then matches them against the FIPS codes for the five boroughs of New York City.</p>
</section>
</section>
<section id="create-standardized-scores" class="level2">
<h2 class="anchored" data-anchor-id="create-standardized-scores">Create Standardized Scores</h2>
<p>Remembering back to your high school or college statistics class, a Z-score (or standardized score) can be be calculated by subtracting from a given observation the mean of all observations and then dividing by the standard deviation of all observations.</p>
<p>Recall:</p>
<p><span class="math inline">\(z = \frac{x-\mu}{\sigma}\)</span> where: <span class="math inline">\(x\)</span> is the individual observation we want to standardize <span class="math inline">\(\mu\)</span> is the population mean <span class="math inline">\(\sigma\)</span> is the population standard deviation</p>
<p>Find the mean and standard deviation for a variable in our dataset and manually calculate a z-score (just for fun).</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-17_68f1ea9a734f53cb72745b85f252b192">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>dataset <span class="sc">|&gt;</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">under18_mean =</span> <span class="fu">mean</span>(under18, <span class="at">na.rm=</span><span class="cn">TRUE</span>), </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">under18_sd =</span> <span class="fu">sd</span>(under18, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">z_under18 =</span> (under18 <span class="sc">-</span> under18_mean)<span class="sc">/</span>under18_sd</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,327 × 3
   under18_mean under18_sd z_under18
          &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
 1        0.205     0.0773   0.960  
 2        0.205     0.0773   1.98   
 3        0.205     0.0773   0.572  
 4        0.205     0.0773  -0.254  
 5        0.205     0.0773   0.980  
 6        0.205     0.0773   0.706  
 7        0.205     0.0773  -0.253  
 8        0.205     0.0773   0.865  
 9        0.205     0.0773  -0.00949
10        0.205     0.0773   0.539  
# … with 2,317 more rows</code></pre>
</div>
</div>
<p>For the first observation, the value for Under 18 is 27.9 percent. The average value for tracts in Illinois is 27.9 percent, and the standard deviation is 7.73. The standardized score of .960 indicates that the observation is .96 of a standard deviation above the mean. There’s absolutely nothing wrong with doing this manually, however, we can use the <code>scale()</code> function to do the same thing:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-18_9e2c5d8f0c760bedf4228e3e402cd398">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>dataset <span class="sc">|&gt;</span>  <span class="fu">mutate</span>(<span class="at">under18 =</span> <span class="fu">scale</span>(under18))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,327 × 30
   GEOID      under1…¹ over65   Pop P_Fem…² PWhite PBlack   PAIAN PAsian PNonw…³
   &lt;chr&gt;         &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
 1 360470092…  0.960   0.0747  3453   0.514 0.296  0.0568 0.00782 0.300    0.704
 2 360470094…  1.98    0.0763  2293   0.515 0.0754 0.0754 0       0.690    0.925
 3 360470094…  0.572   0.0885  2746   0.548 0.172  0.0138 0       0.695    0.828
 4 360470096… -0.254   0.132   5858   0.570 0.362  0.0446 0.00751 0.340    0.638
 5 360470098…  0.980   0.0864  6021   0.498 0.153  0.0485 0       0.383    0.847
 6 360470100…  0.706   0.128   5978   0.541 0.264  0.0238 0.0110  0.423    0.736
 7 360470101… -0.253   0.0842  3944   0.508 0.510  0.0418 0.0327  0.0903   0.490
 8 360470102…  0.865   0.126   4844   0.515 0.124  0.0142 0       0.705    0.876
 9 360470104… -0.00949 0.125   2152   0.487 0.106  0.0279 0       0.838    0.894
10 360470104…  0.539   0.148   2256   0.523 0.0638 0      0       0.879    0.936
# … with 2,317 more rows, 20 more variables: PLatino &lt;dbl&gt;, PForeignborn &lt;dbl&gt;,
#   P_FHHH &lt;dbl&gt;, Pov &lt;dbl&gt;, MHHI &lt;dbl&gt;, Rvac &lt;dbl&gt;, P_Own &lt;dbl&gt;, MHV &lt;dbl&gt;,
#   CostBurden &lt;dbl&gt;, STUSAB &lt;chr&gt;, pct_transit_j2w &lt;dbl&gt;,
#   median_gross_rent &lt;dbl&gt;, pct_hu_1_detached &lt;dbl&gt;, job_density_simple &lt;dbl&gt;,
#   retail_density_simple &lt;dbl&gt;, median_commute &lt;dbl&gt;, CANCER &lt;dbl&gt;,
#   RESP &lt;dbl&gt;, PTRAF &lt;dbl&gt;, PM25 &lt;dbl&gt;, and abbreviated variable names
#   ¹​under18[,1], ²​P_Female, ³​PNonwhite</code></pre>
</div>
</div>
<p>This brings up an important question - what should the reference geography be for our opportunity measures? We narrowed down our dataset to New York City, however, we could have just as easily used the state or the nation. It’s important to keep in mind that once we construct Z-scores for our indicators, they are with reference to the distribiotn of values we choose to include. We are using the city of New York City as our point of reference. Using the state as a point of reference may be relevant and useful, especially if we want to make some comparisons across the state. At the same time, the characteristics of New York City and other metropolitan areas are likely to be very different than the balance of the state, and so comparisons for the purpose of standardizing our data may be a bit distorted. Now that we have our reference region selected, we can move forward with standardizing each indicator value.</p>
<p>Before we do this, it can be useful to provide a more intuitive description of each variable (since most people do not think about indicators in standardized terms). You may recall us previously using commands like <code>summary()</code> for basic descriptives.</p>
<p>We’re going to use a variant of the <code>summarise</code> command which you’ve used in the past. <code>summarise_at()</code> allows us to select variables to summarise by their name, and will then apply the same function across all of those variables. Let’s find the mean for each of the indicator variables in our compiled dataset:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-19_594b28270e12cc16aab3bf6e7ead3e55">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>dataset <span class="sc">|&gt;</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_at</span>(<span class="fu">vars</span>(under18<span class="sc">:</span>median_commute), mean, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 25
  under18 over65   Pop P_Female PWhite PBlack   PAIAN PAsian PNonwhite PLatino
    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1   0.205  0.151 3601.    0.519  0.410  0.250 0.00443  0.148     0.590   0.271
# … with 15 more variables: PForeignborn &lt;dbl&gt;, P_FHHH &lt;dbl&gt;, Pov &lt;dbl&gt;,
#   MHHI &lt;dbl&gt;, Rvac &lt;dbl&gt;, P_Own &lt;dbl&gt;, MHV &lt;dbl&gt;, CostBurden &lt;dbl&gt;,
#   STUSAB &lt;dbl&gt;, pct_transit_j2w &lt;dbl&gt;, median_gross_rent &lt;dbl&gt;,
#   pct_hu_1_detached &lt;dbl&gt;, job_density_simple &lt;dbl&gt;,
#   retail_density_simple &lt;dbl&gt;, median_commute &lt;dbl&gt;</code></pre>
</div>
</div>
<p>We use <code>vars()</code> to specify the variables to summarize by their name, using the colon to specify through (e.g.&nbsp;under18 through median_commute). We specify that we want our summary statistic to be the mean, and we specify that we want to remove NAs so we get a usable statistic out. This gives us some usable statistics for the entire region. We might also want to derive summaries for each of the counties in the region - how could we do this using your knowledge of <code>group_by()</code>, <code>substr()</code>, and <code>summarise_at()</code>?</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-20_f11e0be98726e5ba7ca0d7c0f5ee174b">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>dataset <span class="sc">|&gt;</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">substr</span>(GEOID, <span class="dv">0</span>, <span class="dv">5</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_at</span>(<span class="fu">vars</span>(under18<span class="sc">:</span>median_commute), mean, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mean.default(STUSAB, na.rm = TRUE): argument is not numeric or
logical: returning NA

Warning in mean.default(STUSAB, na.rm = TRUE): argument is not numeric or
logical: returning NA

Warning in mean.default(STUSAB, na.rm = TRUE): argument is not numeric or
logical: returning NA

Warning in mean.default(STUSAB, na.rm = TRUE): argument is not numeric or
logical: returning NA

Warning in mean.default(STUSAB, na.rm = TRUE): argument is not numeric or
logical: returning NA</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 26
  substr(GEO…¹ under18 over65   Pop P_Fem…² PWhite PBlack   PAIAN PAsian PNonw…³
  &lt;chr&gt;          &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1 36005          0.241  0.134 3953.   0.528  0.235  0.344 0.00712 0.0414   0.765
2 36047          0.224  0.144 3201.   0.524  0.430  0.313 0.00320 0.122    0.570
3 36061          0.134  0.167 5255.   0.520  0.570  0.142 0.00342 0.128    0.430
4 36081          0.195  0.160 3132.   0.509  0.355  0.200 0.00528 0.247    0.645
5 36085          0.215  0.160 3775.   0.513  0.688  0.124 0.00231 0.0990   0.312
# … with 16 more variables: PLatino &lt;dbl&gt;, PForeignborn &lt;dbl&gt;, P_FHHH &lt;dbl&gt;,
#   Pov &lt;dbl&gt;, MHHI &lt;dbl&gt;, Rvac &lt;dbl&gt;, P_Own &lt;dbl&gt;, MHV &lt;dbl&gt;,
#   CostBurden &lt;dbl&gt;, STUSAB &lt;dbl&gt;, pct_transit_j2w &lt;dbl&gt;,
#   median_gross_rent &lt;dbl&gt;, pct_hu_1_detached &lt;dbl&gt;, job_density_simple &lt;dbl&gt;,
#   retail_density_simple &lt;dbl&gt;, median_commute &lt;dbl&gt;, and abbreviated variable
#   names ¹​`substr(GEOID, 0, 5)`, ²​P_Female, ³​PNonwhite</code></pre>
</div>
</div>
<p>You can start to see some of the differences that exist between distributions at the borough (county) level. Do any stick out to you at this point?</p>
<p>Ok, we have created a numeric summary table that may be useful for reporting out. Now we can produce our standardized scores which we can use for index making.</p>
<p>Now that you have defined your region, described the data for your region, and know how to standardize the values, you can create a scaled version of your data. Earlier, we learned how to use <code>summarise_at()</code> to select variables to summarize using a specific function. There’s also a <code>mutate_at()</code> function which allows you to perform the same alteration upon all of the variables you select. Take a look at the documentation for <code>mutate_at()</code>. You’ll need to supply the variables you want to mutate, as well as the function (read closely the documentation and examples before proceeding).</p>
<p>Now let’s go ahead and create a <strong>separate</strong> dataset called dataset_scaled which contains the scaled values (there may a few fields which either do not need scaling or who you can remove):</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-21_048ad88f9f5c82d63b18838ae7f0b5fd">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>dataset_scaled<span class="ot">&lt;-</span>dataset <span class="sc">|&gt;</span>  </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(under18, over65, P_Female, PNonwhite, PForeignborn, P_FHHH, Pov, MHHI, P_Own, MHV, CostBurden, CANCER, RESP, PTRAF, PM25, pct_transit_j2w, median_gross_rent, pct_hu_1_detached, job_density_simple, retail_density_simple, median_commute), <span class="fu">list</span>(<span class="at">scale=</span>scale))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We are in the home stretch! We are very close to being able to make our index. We need to determine how we think each variable is related to opportunity. In some cases, higher values are “good”, and in some cases, lower values are “good”. We need to make sure that those values are all moving in the same direction so that when we combine them they do not counter-act each other.</p>
<p>Below is a table proposing potential directions for each variable.</p>
<ul>
<li><strong>Negative:</strong> For a variable labeled <strong>Negative</strong>, higher values are likely to indicate lower levels of opportunity.</li>
<li><strong>Positive:</strong> Far a variable labeled <strong>Positive</strong>, higher values are likely to indicate higher levels of opportunity.</li>
</ul>
<table class="table">
<colgroup>
<col style="width: 22%">
<col style="width: 33%">
<col style="width: 22%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Description</th>
<th>Relationship to Opportunity</th>
<th>Category</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>under18</td>
<td>Proportion of Population under 18</td>
<td>Negative</td>
<td>Demographic Structure</td>
</tr>
<tr class="even">
<td>over65</td>
<td>Proportion of Population over 65</td>
<td>Negative</td>
<td>Demographic Structure</td>
</tr>
<tr class="odd">
<td>PNonwhite</td>
<td>Proportion Population Nonwhite</td>
<td>Negative</td>
<td>Demographic Structure</td>
</tr>
<tr class="even">
<td>PForeignborn</td>
<td>Proportion Population Foreign Born</td>
<td>Negative</td>
<td>Demographic Structure</td>
</tr>
<tr class="odd">
<td>MHHI</td>
<td>Median Household Income</td>
<td>Positive</td>
<td>Employment and Economy</td>
</tr>
<tr class="even">
<td>P_FHHH</td>
<td>Proportion Female Headed Households</td>
<td>Negative</td>
<td>Demographic Structure</td>
</tr>
<tr class="odd">
<td>Pov</td>
<td>Proportion Households Below Poverty</td>
<td>Negative</td>
<td>Demographic Structure</td>
</tr>
<tr class="even">
<td>P_Own</td>
<td>Proportion Owner Occupied Housing Units</td>
<td>Positive</td>
<td>Housing</td>
</tr>
<tr class="odd">
<td>MHV</td>
<td>Median Home Value</td>
<td>Positive</td>
<td>Housing</td>
</tr>
<tr class="even">
<td>CostBurden</td>
<td>Housing Cost Burden</td>
<td>Negative</td>
<td>Housing</td>
</tr>
<tr class="odd">
<td>CANCER</td>
<td>Cancer Risk Index</td>
<td>Negative</td>
<td>Environmental Health</td>
</tr>
<tr class="even">
<td>RESP</td>
<td>Respiratory Hazard Index</td>
<td>Negative</td>
<td>Environmental Health</td>
</tr>
<tr class="odd">
<td>PTRAF</td>
<td>Traffic Proximity Index</td>
<td>Negative</td>
<td>Environmental Health</td>
</tr>
<tr class="even">
<td>PM25</td>
<td>Particulate Matter Index</td>
<td>Negative</td>
<td>Environmental Health</td>
</tr>
<tr class="odd">
<td>pct_transit_j2w</td>
<td>Commuting by Public Transportation</td>
<td>Positive</td>
<td>Transportation</td>
</tr>
<tr class="even">
<td>median_gross_rent</td>
<td>Median Gross Rent</td>
<td>Negative</td>
<td>Housing</td>
</tr>
<tr class="odd">
<td>pct_hu_1_detatched</td>
<td>Detatched Housing Units</td>
<td>Positive</td>
<td>Housing</td>
</tr>
<tr class="even">
<td>job_density_simple</td>
<td>Job Density</td>
<td>Positive</td>
<td>Employment and Economy</td>
</tr>
<tr class="odd">
<td>retail_density_simple</td>
<td>Retail Density</td>
<td>Positive</td>
<td>Employment and Economy</td>
</tr>
<tr class="even">
<td>median_commute</td>
<td>Median Commute Time</td>
<td>Negative</td>
<td>Transportation</td>
</tr>
</tbody>
</table>
<p>We are going to create an **additive* index, where standardized values are simply adde together. We can transform values so that they are moving in the same direction by simply switching the sign on values that need to be reversed (e.g.&nbsp;multiply by -1). Based upon the above table, Here’s what that would look like:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-22_b1adebb6de1e169eae5306778327b76c">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>dataset_scaled<span class="ot">&lt;-</span>dataset_scaled <span class="sc">|&gt;</span>  <span class="fu">mutate</span>(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">under18_scale =</span> under18_scale<span class="sc">*-</span><span class="dv">1</span>,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">over65_scale =</span> over65_scale<span class="sc">*-</span><span class="dv">1</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">PNonwhite_scale =</span> PNonwhite_scale<span class="sc">*-</span><span class="dv">1</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">PForeignborn_scale =</span> PForeignborn_scale<span class="sc">*-</span><span class="dv">1</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">P_FHHH_scale =</span> P_FHHH_scale<span class="sc">*-</span><span class="dv">1</span>,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Pov_scale =</span> Pov_scale<span class="sc">*-</span><span class="dv">1</span>,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">CostBurden_scale =</span> CostBurden_scale <span class="sc">*-</span><span class="dv">1</span>,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">CANCER_scale =</span> CANCER_scale<span class="sc">*-</span><span class="dv">1</span>,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">RESP_scale =</span> RESP_scale<span class="sc">*-</span><span class="dv">1</span>,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">PTRAF_scale =</span> PTRAF_scale<span class="sc">*-</span><span class="dv">1</span>,</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">PM25_scale =</span> PM25_scale<span class="sc">*-</span><span class="dv">1</span>,</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">median_gross_rent_scale =</span> median_gross_rent_scale<span class="sc">*-</span><span class="dv">1</span>,</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">median_commute_scale =</span> median_commute_scale<span class="sc">*-</span><span class="dv">1</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>By making these changes, once we add up our indicator values, we are essentially saying that larger values are indicative of greater opportunity and smaller values are indicative of less opportunity. Let’s do two things here - we can add up all of our values to get an overall opportunity score, but let’s also create sub-indicators for each category, as this may be useful information for us to observe.</p>
<p>To do this, add several new variables to dataset_scaled that sum together each of the index measures by category, and then create a separate indicator that sums up those category columns into an overall opportunity measure:</p>
<p>Use the following labels:</p>
<ul>
<li>dem_index = Demographic Structure</li>
<li>emp_index = Employment and Economy</li>
<li>hou_index = Housing</li>
<li>env_index = Environmental Health</li>
<li>tra_index = Transportation</li>
<li>tot_index = Combined Total Index</li>
</ul>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-23_28c69d753dabfd53bf25974c31da6f5f">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dataset_scaled<span class="ot">&lt;-</span>dataset_scaled <span class="sc">|&gt;</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dem_index =</span> <span class="fu">sum</span>(under18_scale, over65_scale, PNonwhite_scale, PForeignborn_scale, P_FHHH_scale, Pov_scale, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">emp_index =</span> <span class="fu">sum</span>(MHHI_scale, job_density_simple_scale, retail_density_simple_scale, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">hou_index =</span> <span class="fu">sum</span>(P_Own_scale, MHV_scale, CostBurden_scale, median_gross_rent_scale, pct_hu_1_detached_scale, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">env_index =</span> <span class="fu">sum</span>(CANCER_scale, RESP_scale, PTRAF_scale, PM25_scale, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">tra_index =</span> <span class="fu">sum</span>(pct_transit_j2w_scale, median_commute_scale,<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">tot_index =</span> dem_index <span class="sc">+</span> emp_index <span class="sc">+</span> hou_index <span class="sc">+</span> env_index <span class="sc">+</span> tra_index</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Something’s a little different here that makes a big difference. Did you notice <code>rowwise()</code>? Typically, if we were to ask dplyr to mutate by providing a sum, it would do so by column. <code>rowwise()</code> modifies this and asks for something to happen across a data observation (row) instead of by column. Therefore, when we ask in a mutate statement for the sum of values, we are asking R to add up the values in the same row and then insert the product into a new variable (in this case our named indexes). Pretty cool, right?</p>
<p>Ok - now we have subindex values as well as a total index value. We could analyze these and interpret them as is, but there’s one more thing that we might do to make these easier to interpret. Let’s quickly look at some descriptive stats for our index values and think about what may be challenging for us to interpret:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-24_5a1bee2aa7a54e004a1115d1ebe254bd">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>dataset_scaled <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dem_index, emp_index, hou_index, env_index, tra_index, tot_index) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   dem_index          emp_index         hou_index         env_index      
 Min.   :-10.7759   Min.   :-2.4750   Min.   :-7.3245   Min.   :-14.084  
 1st Qu.: -2.1811   1st Qu.:-0.8973   1st Qu.:-1.5020   1st Qu.: -1.639  
 Median : -0.1554   Median :-0.3840   Median :-0.1535   Median :  0.000  
 Mean   :  0.0000   Mean   : 0.0000   Mean   : 0.0000   Mean   :  0.000  
 3rd Qu.:  2.1316   3rd Qu.: 0.1484   3rd Qu.: 1.1933   3rd Qu.:  1.443  
 Max.   : 11.8808   Max.   :31.0470   Max.   :10.5857   Max.   :  9.302  
   tra_index         tot_index      
 Min.   :-6.7759   Min.   :-19.994  
 1st Qu.:-0.8376   1st Qu.: -3.762  
 Median : 0.0000   Median :  0.000  
 Mean   : 0.0000   Mean   :  0.000  
 3rd Qu.: 1.1383   3rd Qu.:  3.605  
 Max.   : 3.3514   Max.   : 35.604  </code></pre>
</div>
</div>
<p>Looking at this, there are a few challenges:</p>
<ul>
<li>Since each subindex component consists of between two and six values, they end up having very different scales. This means that we can’t interpret anything about the magnitude by comparing these values to each other.</li>
<li>We have both positive and negative index values. Negative values don’t necessarily mean anything other than that the sum of index values is negative.</li>
</ul>
<p>One strategy for making these values more interpretable is to <strong>rescale</strong> them. Do not confuse <em>rescaling</em> with the type of <em>standardizing</em> which we previously performed by converting our indicator values into z scores. Rescaling will take the data from an existing range and convert it to a new range of values.</p>
<p>Rescaling converts our data from its existing range of values to a new range of values, preserving the magnitude of difference that exists between the values:</p>
<p>If we want to convert our data to the range [0,1] here’s what we’d do: <span class="math inline">\(x_{rescaled} = \frac{x-min(x)}{max(x)-min(x)}\)</span></p>
<p>We can also convert our data to an arbitrary range. Let’s try 0,100: <span class="math inline">\(x_{rescaled} = a+\frac{x-min(x)(b-a)}{max(x) -min(x)}\)</span></p>
<p>Fortunately, R has us covered here too - the <code>rescale</code> function in the <code>scales</code> package will rescale to whatever range we wish:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-25_8e0c1401a2e61df193314523fac13504">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>dataset_scaled <span class="ot">&lt;-</span>dataset_scaled <span class="sc">|&gt;</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dem_index =</span> <span class="fu">rescale</span>(dem_index, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>)),</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">emp_index =</span> <span class="fu">rescale</span>(emp_index, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>)),</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">hou_index =</span> <span class="fu">rescale</span>(hou_index, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>)),</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">env_index =</span> <span class="fu">rescale</span>(env_index, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>)),</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">tra_index =</span> <span class="fu">rescale</span>(tra_index, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>)),</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">tot_index =</span> <span class="fu">rescale</span>(tot_index, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>))</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>dataset_scaled <span class="sc">|&gt;</span>  </span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dem_index, emp_index, hou_index, env_index, tra_index, tot_index) <span class="sc">|&gt;</span> </span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   dem_index        emp_index         hou_index        env_index     
 Min.   :  0.00   Min.   :  0.000   Min.   :  0.00   Min.   :  0.00  
 1st Qu.: 37.93   1st Qu.:  4.707   1st Qu.: 32.51   1st Qu.: 53.22  
 Median : 46.88   Median :  6.238   Median : 40.04   Median : 60.23  
 Mean   : 47.56   Mean   :  7.383   Mean   : 40.90   Mean   : 60.23  
 3rd Qu.: 56.97   3rd Qu.:  7.826   3rd Qu.: 47.56   3rd Qu.: 66.40  
 Max.   :100.00   Max.   :100.000   Max.   :100.00   Max.   :100.00  
   tra_index        tot_index     
 Min.   :  0.00   Min.   :  0.00  
 1st Qu.: 58.64   1st Qu.: 29.20  
 Median : 66.91   Median : 35.96  
 Mean   : 66.91   Mean   : 35.96  
 3rd Qu.: 78.15   3rd Qu.: 42.45  
 Max.   :100.00   Max.   :100.00  </code></pre>
</div>
</div>
<p>The values are all rescaled so that the minimum is now zero and the maximum value is 100. We use <code>ungroup()</code> here so that if we have used <code>group_by()</code> in the past, R ignores those past groupings when we rescale. Looking at the descriptive statistics for these variables, there’s still some <strong>skew</strong> in many cases. We might want to try visualizing these distributions so that we can better understand their implications.</p>
</section>
<section id="visualizing-index-values" class="level1">
<h1>Visualizing Index Values</h1>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-26_41fc635a1f9c5c522006bc8d7c95c286">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s start our data visualization by making a simple histogram of values for our tot_index measure:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-27_7d77ee33563da9066b5ae9d9472136aa">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>tot_index))<span class="sc">+</span><span class="fu">geom_histogram</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>What’s going on here? We call <code>ggplot</code> (<code>ggplot()</code>) and then start adding layers to our plot. In its most basic form, ggplot needs to know the data source, as well as some aesthetic mappings for the data. The data source can be called by name, and the aesthetic mappings are placed in <code>aes()'. After this, we can specify a format for our plot by asking it to plot using a particular geometry, in this case</code>geom_histogram()`.</p>
<p>You have probably observed that ggplot tells us that it is using a somewhat arbitrary bin width for our histogram. We can select another one by adding to the histogram geometry a specification for a different number of bins:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-28_8340cf1c4ce38aa5b346e3cb4e48827a">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>tot_index))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Notice, we go from 30 bins to 100 bins, meaning that they become much narrower as each captures and counts a smaller range of the data.</p>
<p>We can add other elements to our plot that help to make it look nice:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-29_eb55d2ab6c811a44248dab2f67343a25">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>tot_index))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">100</span>)<span class="sc">+</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Opportunity Index: Histogram"</span>, <span class="at">x=</span><span class="st">"Opportunity Index"</span>, <span class="at">y=</span><span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Have a look at the <a href="https://rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf">ggplot2 cheat sheet</a> for some inspiration on how you can alter your plots further.</p>
<p>Go ahead and produce similar histograms for each of the subindex components. Feel free to play around with some of the aesthetics just for fun!</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-30_f6b4e6e0314916028e3f54e278f60fe7">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your Code Here</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>dem_index))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">100</span>)<span class="sc">+</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Demographic Structure Subindex: Histogram"</span>, <span class="at">x=</span><span class="st">"Opportunity Index"</span>, <span class="at">y=</span><span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>emp_index))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">100</span>)<span class="sc">+</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Employment and Economy Subindex: Histogram"</span>, <span class="at">x=</span><span class="st">"Opportunity Index"</span>, <span class="at">y=</span><span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-30-2.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>hou_index))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">100</span>)<span class="sc">+</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Housing Subindex: Histogram"</span>, <span class="at">x=</span><span class="st">"Opportunity Index"</span>, <span class="at">y=</span><span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-30-3.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>env_index))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">100</span>)<span class="sc">+</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Environmental Health Subindex: Histogram"</span>, <span class="at">x=</span><span class="st">"Opportunity Index"</span>, <span class="at">y=</span><span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-30-4.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>tra_index))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">100</span>)<span class="sc">+</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Transportation Subindex: Histogram"</span>, <span class="at">x=</span><span class="st">"Opportunity Index"</span>, <span class="at">y=</span><span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-30-5.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Referring back to the <a href="https://rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf">ggplot2 cheat sheet</a>, try your hand at some other one variable visualizations (good places to start would be <code>geom_area</code>, <code>geom_density</code>, and <code>geom_bar</code>:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-31_275d5952908ddbb63b10b3ca69818a4a">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>tra_index))<span class="sc">+</span><span class="fu">geom_area</span>(<span class="at">stat=</span><span class="st">"bin"</span>, <span class="at">bins=</span><span class="dv">100</span>)<span class="sc">+</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Transportation Subindex: Histogram"</span>, <span class="at">x=</span><span class="st">"Opportunity Index"</span>, <span class="at">y=</span><span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="demographics-by-opportunity-levels" class="level1">
<h1>Demographics by Opportunity Levels</h1>
<p>Let’s take a look at our overall opportunity index again:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-32_29c1227414ddbda9f39ec3b8fe78cf54">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>tot_index))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">100</span>)<span class="sc">+</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Opportunity Index: Histogram"</span>, <span class="at">x=</span><span class="st">"Opportunity Index"</span>, <span class="at">y=</span><span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>How might we start to think about some of the demographic correlates of who lives in places with higher aggregate opportunity and lower aggregate opportunity? You’ll recall from when we initially created our index that we had downloaded some information on race and ethnicity which was not incorporated into our opportunity measures. We might be interested to see how our composite measure of low and high opportunity are related to the racial and ethnic composition of the census tracts they are from.</p>
<p>We might turn towards a some bivariate visualizations to help us here. Let’s start with a simple scatterplot:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-33_40de3e474b1bde8aae18812be60a033f">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PWhite, <span class="at">y =</span>tot_index))<span class="sc">+</span><span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 86 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>How would you describe the relationship visualized here (note that I shifted the index values to the y scale and placed percent white on the x scale)? To make it easier, let’s add another geometry to the same plot, in this case, by fitting a line to our data:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-34_0dab14021461016483ed260311b1a6e6">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PWhite, <span class="at">y =</span>tot_index))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 86 rows containing non-finite values (stat_smooth).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 86 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>How would you describe the relationship between the tract-level concentration of the white population and the overall index score?</p>
<p>We might want to polish things up a little more - here are some suggested additions to think about.</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-35_f057b35a1598b8d26eba9f457653a731">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PWhite, <span class="at">y =</span>tot_index))<span class="sc">+</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">6</span>, <span class="at">cex =</span> .<span class="dv">75</span>)<span class="sc">+</span> <span class="co"># Use alpha to control the transparency of the points and cex to control their size</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"White (%)"</span>, <span class="at">y =</span> <span class="st">"Combined Opportunity Index"</span>)<span class="sc">+</span> <span class="co"># Add labels to the x and y axes</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent)<span class="sc">+</span> <span class="co"># Use the scales package to convert X-axis to percentages</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="co">#Use themes to eliminate extra shading on plots</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 86 rows containing non-finite values (stat_smooth).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 86 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Your turn - produce similar plots for the Black, Asian, and Latino populations:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-36_f593cb41acb15af5815d8804f8fb68e0">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your Work Here</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PBlack, <span class="at">y =</span>tot_index))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 86 rows containing non-finite values (stat_smooth).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 86 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PAsian, <span class="at">y =</span>tot_index))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 86 rows containing non-finite values (stat_smooth).
Removed 86 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-36-2.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PLatino, <span class="at">y =</span>tot_index))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 86 rows containing non-finite values (stat_smooth).
Removed 86 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-36-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="how-different-are-counties-in-the-region" class="level1">
<h1>How different are counties in the region?</h1>
<p>So far, we’ve been looking at opportunity scores for the New York City. The values we see are likely to be very different for different boroughs. Let’s disaggregate and make some comparisons.</p>
<p>As a reminder, here are the county FIPS codes for the boroughs in the city:</p>
<table class="table">
<thead>
<tr class="header">
<th>FIPS Code</th>
<th>County Name</th>
<th>Borough Name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>36047</td>
<td>Kings County</td>
<td>Brooklyn</td>
</tr>
<tr class="even">
<td>36005</td>
<td>Bronx County</td>
<td>Bronx</td>
</tr>
<tr class="odd">
<td>36081</td>
<td>Queens County</td>
<td>Queens</td>
</tr>
<tr class="even">
<td>36085</td>
<td>Richmond County</td>
<td>Staten Island</td>
</tr>
<tr class="odd">
<td>36061</td>
<td>New York County</td>
<td>Manhattan</td>
</tr>
</tbody>
</table>
<p>Let’s label each tract by the borough (county) that contains it.</p>
<p>We used <code>case_when()</code> in the past. <code>case_when()</code> allows us to set up multiple conditions to search for, and then we can determine what to do when we have found records which match that condition:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-37_f7966eec6364d5d64b992264488eadc0">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>dataset_scaled<span class="ot">&lt;-</span>dataset_scaled <span class="sc">|&gt;</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">location =</span> <span class="fu">case_when</span>(</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">substr</span>(GEOID, <span class="dv">0</span>,<span class="dv">5</span>) <span class="sc">==</span> <span class="st">"36047"</span> <span class="sc">~</span> <span class="st">"Brooklyn"</span>,</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">substr</span>(GEOID, <span class="dv">0</span>,<span class="dv">5</span>) <span class="sc">==</span> <span class="st">"36005"</span> <span class="sc">~</span> <span class="st">"Bronx"</span>,</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">substr</span>(GEOID, <span class="dv">0</span>,<span class="dv">5</span>) <span class="sc">==</span> <span class="st">"36081"</span> <span class="sc">~</span> <span class="st">"Queens"</span>,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">substr</span>(GEOID, <span class="dv">0</span>,<span class="dv">5</span>) <span class="sc">==</span> <span class="st">"36085"</span> <span class="sc">~</span> <span class="st">"Staten Island"</span>,</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">substr</span>(GEOID, <span class="dv">0</span>,<span class="dv">5</span>) <span class="sc">==</span> <span class="st">"36061"</span> <span class="sc">~</span> <span class="st">"Manhattan"</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In this case, we create a new variable called location, and then label those records where the county FIPS code is equal to a particular county.</p>
<p>Now that we have this new differentiating variable, we can modify our existing plots to illustrate differences between boroughs. We can start by <strong>faceting</strong> our existing chart. Facets take categorical variables and split the chart into as many multiples as there are categories. In our case, we can use our new location variable as a facet, so we should expect five multiples in an updated chart:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-38_01dbb0323806c0215bc5d02fff34070a">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>tot_index))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">100</span>)<span class="sc">+</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Opportunity Index: Histogram"</span>, <span class="at">x=</span><span class="st">"Opportunity Index"</span>, <span class="at">y=</span><span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>location)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The tilde (<code>~</code>) is necessary before listing the variable you want to facet.</p>
<p>This gives us a sense of the relative shape and distribution of opportunity index values for each county. As an alternative strategy to use our facets, we might want to set our scales to “free” in our histogram settings so that we can better compare the shape of our histograms. The distortion we see is due to Brooklyn and Queens having more tracts, thereby creating higher peaks within any given bin. By setting scales to “free”, ggplot sets the scales based upon the range of data contained only within a given facet instead of across all facets:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-39_668b028cdae2676041b5ced0a112733e">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>tot_index))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">100</span>)<span class="sc">+</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Opportunity Index: Histogram"</span>, <span class="at">x=</span><span class="st">"Opportunity Index"</span>, <span class="at">y=</span><span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>location, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>What can this tell us about the distribution of opportunity scores within each borough in New York City?</p>
<p>Now go ahead and re-create the scatterplot we previously created that compared the White population on the x axis to the overall opportunity index score on the y axis. Be sure to facet by location. Go ahead and add a summary line of best fit as well.</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-40_03e71f0e048552fd80dd4de6f42181d6">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PWhite, <span class="at">y =</span>tot_index))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>location)<span class="sc">+</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 86 rows containing non-finite values (stat_smooth).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 86 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let’s try faceting subindex values to see how they differ. Are there any that you can see any substantial visual differences on? How would you explain the differences that you see?</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-41_75735f12e982105f28007dbfaf694f70">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PWhite, <span class="at">y =</span>dem_index))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>location)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 86 rows containing non-finite values (stat_smooth).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 86 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PWhite, <span class="at">y =</span>emp_index))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>location)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 86 rows containing non-finite values (stat_smooth).
Removed 86 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-41-2.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PWhite, <span class="at">y =</span>hou_index))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>location)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 86 rows containing non-finite values (stat_smooth).
Removed 86 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-41-3.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PWhite, <span class="at">y =</span>env_index))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>location)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 86 rows containing non-finite values (stat_smooth).
Removed 86 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-41-4.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PWhite, <span class="at">y =</span>tra_index))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>location)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 86 rows containing non-finite values (stat_smooth).
Removed 86 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-41-5.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>So far, we have learned how to display fit regression lines on top of our point data. Sometimes, it can be useful to simply display those lines without the associated point data. As part of our aesthetic mapping, we can set a grouping variable (group), and also tell ggplot to vary the colour (British spelling, please) of each group. In this case, we set both of these based upon the location variable:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-42_200da59afb4fecab8f894031d7a004f2">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PWhite, <span class="at">y =</span>tot_index, <span class="at">group=</span>location, <span class="at">colour=</span>location))<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 86 rows containing non-finite values (stat_smooth).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>How would you interpret the differences between the two lines (without points)? Can you re-create similar graphics for some of the subindex categories or other racial identifications?</p>
<p>Finally, let’s combine some of what we’ve learned here to visualize groups for both the point data and the associated regression lines:</p>
<div class="cell" data-hash="09_placeopportunity_cache/html/unnamed-chunk-43_8fe7b6142313dfa650e11d5782dc0931">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PWhite, <span class="at">y =</span>tot_index, <span class="at">group=</span>location, <span class="at">colour=</span>location))<span class="sc">+</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span>.<span class="dv">075</span>)<span class="sc">+</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">alpha =</span> .<span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"White Population (%)"</span>, <span class="at">y =</span> <span class="st">"Opportunity Index"</span>, <span class="at">colour =</span> <span class="st">"County"</span>)<span class="sc">+</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent)<span class="sc">+</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 86 rows containing non-finite values (stat_smooth).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 86 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="09_placeopportunity_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>I have used <code>theme_classic()</code> here to remove the gray background which I think makes it difficult to see the points and lines well. In the point geometries, I have used the <em>alpha</em> value to alter the transparency of the points. This can help us to see some of the differences between boroughs. If you look carefully, you’ll also see that there is a rather dense cluster of tracts that are mostly non-white with relatively high opportunity scores in Queens. In this chart, we can also see how those tracts with a high proportion of white people and high index values are what is likely bringing up the slope of the regression line for the total index.</p>
<p>Spend some time playing around with these visualizations using different aesthetic mappings and different x and y variables. Think about how you can creatively layer different components and also about the types of stories that you can tell about opportunity in Illinois.</p>
<section id="extending-your-analysis" class="level2">
<h2 class="anchored" data-anchor-id="extending-your-analysis">Extending your Analysis</h2>
<p>The most standard next step in opportunity mapping is…</p>
<ul>
<li>Making a map. Drawing from your index data, make a map of your overall index score for your place or region, as well as for index sub-components. What spatial patterns emerge? Map out key demographic information - how do these seem to be related to your overall measures of opportunity?</li>
</ul>
<!-- -->
<ul>
<li>Create summary visualizations and tables that display where the highest and lowest levels of opportunity are within the region? Who lives in these places?</li>
<li>Consider connecting your opportunity indexes to other data (examples might include public health statistics, transportation costs, presence of public or subsidized housing, etc.) How does a multidimensional opportunity index help you tell stories about these places?</li>
<li>Create a journalistic narrative about opportunity in your place or for another region. What makes your story powerful, and what story is it telling?</li>
</ul>
</section>
<section id="lab-evaluation" class="level2">
<h2 class="anchored" data-anchor-id="lab-evaluation">Lab Evaluation</h2>
<p>In evaluating your lab submission, we’ll be paying attention to the following:</p>
<ol type="1">
<li>A demonstrated conceptual understanding of the opportunity concept and the way it becomes operationalized with quantitative demographic data.</li>
<li>Correct re-deployment of the code based used in this lab for your own place or region.</li>
<li>A clear narrative analysis of opportunity for your place.</li>
<li>Proper formatting of tables, figures, and visualizations.</li>
</ol>
<p>As you get into the lab, please feel welcome to ask us questions, and please share where you’re struggling with us and with others in the class.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb94" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Place Opportunity"</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="an">sidebar:</span><span class="co"> false</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="an">toc-depth:</span><span class="co"> 4</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="an">page-layout:</span><span class="co"> full</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> ../references.bib</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a><span class="an">csl:</span><span class="co"> ../apa-6th-edition.csl</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a><span class="co">  cache: true</span></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-overflow: wrap</span></span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools:</span></span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a><span class="co">      source: true</span></span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a><span class="co">      toggle: false</span></span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a><span class="co">      caption: none</span></span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a><span class="an">fig-responsive:</span><span class="co"> true</span></span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb94-30"><a href="#cb94-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb94-31"><a href="#cb94-31" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-32"><a href="#cb94-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-33"><a href="#cb94-33" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb94-34"><a href="#cb94-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-35"><a href="#cb94-35" aria-hidden="true" tabindex="-1"></a>In this lab, we'll extend our knowledge of opportunity maps, and more generally in standardizing and creating indexes from data. This strategy is in some ways an extension of the strategy we used to measure neighborhood change. Our measurement of neighborhood change, however, focused on a single dimension of change - income. In this case, we'll produce a *multidimensional* measure of change.</span>
<span id="cb94-36"><a href="#cb94-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-37"><a href="#cb94-37" aria-hidden="true" tabindex="-1"></a>As we have discussed in class, opportunity maps and other indexes are commonly used to be able to illustrate the distribution of resources across space and over time. These types of indexes are designed to be *multidimensional*, and therefore require a strong theoretical framework connecting concepts related to opportunity to indicators or measures designed to proxy or represent these concepts.</span>
<span id="cb94-38"><a href="#cb94-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-39"><a href="#cb94-39" aria-hidden="true" tabindex="-1"></a><span class="fu">## Goals</span></span>
<span id="cb94-40"><a href="#cb94-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-41"><a href="#cb94-41" aria-hidden="true" tabindex="-1"></a>This lab introduces you to the following: - Common methods for standardizing and constructing indexes from demographic data - Basic concepts associated with relational joins between datasets - Reinforces and provides a means of practicing data visualization and presentation</span>
<span id="cb94-42"><a href="#cb94-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-43"><a href="#cb94-43" aria-hidden="true" tabindex="-1"></a><span class="fu">## Core Concepts</span></span>
<span id="cb94-44"><a href="#cb94-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-45"><a href="#cb94-45" aria-hidden="true" tabindex="-1"></a><span class="fu">### R and Rstudio</span></span>
<span id="cb94-46"><a href="#cb94-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-47"><a href="#cb94-47" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`across()`</span></span>
<span id="cb94-48"><a href="#cb94-48" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`reduce()`</span></span>
<span id="cb94-49"><a href="#cb94-49" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`rowwise()`</span></span>
<span id="cb94-50"><a href="#cb94-50" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`scale()`</span></span>
<span id="cb94-51"><a href="#cb94-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-52"><a href="#cb94-52" aria-hidden="true" tabindex="-1"></a>Let's get going...</span>
<span id="cb94-53"><a href="#cb94-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-54"><a href="#cb94-54" aria-hidden="true" tabindex="-1"></a><span class="fu">## Github Lab Repository</span></span>
<span id="cb94-55"><a href="#cb94-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-56"><a href="#cb94-56" aria-hidden="true" tabindex="-1"></a>If you have not already done so, follow <span class="co">[</span><span class="ot">this link</span><span class="co">](https://classroom.github.com/a/VQuhogi7)</span> to accept the lab Github Classroom assignment repository.</span>
<span id="cb94-57"><a href="#cb94-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-58"><a href="#cb94-58" aria-hidden="true" tabindex="-1"></a><span class="fu">## Download and Prepare Data for Opportunity Mapping</span></span>
<span id="cb94-59"><a href="#cb94-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-60"><a href="#cb94-60" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">National Housing Conference brief</span><span class="co">](https://uofi.box.com/s/icccjttbig4mq94nbi123b6x3o33a4zi)</span> which you read for Tuesday outlines several suggested data sources for opportunity mapping. For the purpose of learning some of the methods associated with opportunity mapping, we'll work with three primary data sources:</span>
<span id="cb94-61"><a href="#cb94-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-62"><a href="#cb94-62" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">U.S. Census Bureau - American Community Survey</span><span class="co">](http://www.data.census.gov)</span></span>
<span id="cb94-63"><a href="#cb94-63" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">HUD Location Affordability Index (version 3.0)</span><span class="co">](https://hudgis-hud.opendata.arcgis.com/datasets/location-affordability-index-v-3)</span></span>
<span id="cb94-64"><a href="#cb94-64" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">EPA EJSCREEN</span><span class="co">](https://www.epa.gov/ejscreen/download-ejscreen-data)</span></span>
<span id="cb94-65"><a href="#cb94-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-66"><a href="#cb94-66" aria-hidden="true" tabindex="-1"></a>You should independently explore the documentation for these datasets and their indicators - there is a treasure trove of documentation to look at. When possible, download data documentation to your docuemtnation project folder.</span>
<span id="cb94-67"><a href="#cb94-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-68"><a href="#cb94-68" aria-hidden="true" tabindex="-1"></a>We'll divide these data into a few conceptual categories commonly seen in opportunity maps: - Education - Housing Characteristics - Social Capital - Public Health and Safety - Employment and Workforce - Transportation and Mobility</span>
<span id="cb94-69"><a href="#cb94-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-70"><a href="#cb94-70" aria-hidden="true" tabindex="-1"></a>| Category                    | Indicator                                        | Data Source                                                                                 |</span>
<span id="cb94-71"><a href="#cb94-71" aria-hidden="true" tabindex="-1"></a>|------------------|------------------------|------------------------------|</span>
<span id="cb94-72"><a href="#cb94-72" aria-hidden="true" tabindex="-1"></a>| Education                   | Population with a High School Diploma or greater | <span class="co">[</span><span class="ot">ACS</span><span class="co">](https://data.census.gov)</span>                                                              |</span>
<span id="cb94-73"><a href="#cb94-73" aria-hidden="true" tabindex="-1"></a>| Education                   | Population with a Bachelor's Degree or greater   | <span class="co">[</span><span class="ot">ACS</span><span class="co">](https://data.census.gov)</span>                                                              |</span>
<span id="cb94-74"><a href="#cb94-74" aria-hidden="true" tabindex="-1"></a>| Housing Characteristics     | Median Home Value                                | <span class="co">[</span><span class="ot">ACS</span><span class="co">](https://data.census.gov)</span>                                                              |</span>
<span id="cb94-75"><a href="#cb94-75" aria-hidden="true" tabindex="-1"></a>| Housing Characteristics     | Median Gross Rent                                | <span class="co">[</span><span class="ot">HUD LAI</span><span class="co">](https://hudgis-hud.opendata.arcgis.com/datasets/location-affordability-index-v-3)</span> |</span>
<span id="cb94-76"><a href="#cb94-76" aria-hidden="true" tabindex="-1"></a>| Housing Characteristics     | Percentage Single Family Housing Units           | <span class="co">[</span><span class="ot">HUD LAI</span><span class="co">](https://hudgis-hud.opendata.arcgis.com/datasets/location-affordability-index-v-3)</span> |</span>
<span id="cb94-77"><a href="#cb94-77" aria-hidden="true" tabindex="-1"></a>| Housing Characteristics     | Gross Rent as Percentage of Income               | <span class="co">[</span><span class="ot">ACS</span><span class="co">](https://data.census.gov)</span>                                                              |</span>
<span id="cb94-78"><a href="#cb94-78" aria-hidden="true" tabindex="-1"></a>| Housing Characteristics     | Housing Cost Burden                              | <span class="co">[</span><span class="ot">ACS</span><span class="co">](https://data.census.gov)</span>                                                              |</span>
<span id="cb94-79"><a href="#cb94-79" aria-hidden="true" tabindex="-1"></a>| Housing Characteristics     | Residential Vacancy Rate                         | <span class="co">[</span><span class="ot">ACS</span><span class="co">](https://data.census.gov)</span>                                                              |</span>
<span id="cb94-80"><a href="#cb94-80" aria-hidden="true" tabindex="-1"></a>| Social Capital              | Population Age 25 - 44                           | <span class="co">[</span><span class="ot">ACS</span><span class="co">](https://data.census.gov)</span>                                                              |</span>
<span id="cb94-81"><a href="#cb94-81" aria-hidden="true" tabindex="-1"></a>| Social Capital              | Median Household Income                          | <span class="co">[</span><span class="ot">ACS</span><span class="co">](https://data.census.gov)</span>                                                              |</span>
<span id="cb94-82"><a href="#cb94-82" aria-hidden="true" tabindex="-1"></a>| Social Capital              | Percent of Households in Poverty                 | <span class="co">[</span><span class="ot">ACS</span><span class="co">](https://data.census.gov)</span>                                                              |</span>
<span id="cb94-83"><a href="#cb94-83" aria-hidden="true" tabindex="-1"></a>| Social Capital              | Percentage of Owner-Occupied Housing Units       | <span class="co">[</span><span class="ot">ACS</span><span class="co">](https://data.census.gov)</span>                                                              |</span>
<span id="cb94-84"><a href="#cb94-84" aria-hidden="true" tabindex="-1"></a>| Employment and Worforce     | Job Density                                      | <span class="co">[</span><span class="ot">HUD LAI</span><span class="co">](https://hudgis-hud.opendata.arcgis.com/datasets/location-affordability-index-v-3)</span> |</span>
<span id="cb94-85"><a href="#cb94-85" aria-hidden="true" tabindex="-1"></a>| Employment and Worforce     | Retail Density                                   | <span class="co">[</span><span class="ot">HUD LAI</span><span class="co">](https://hudgis-hud.opendata.arcgis.com/datasets/location-affordability-index-v-3)</span> |</span>
<span id="cb94-86"><a href="#cb94-86" aria-hidden="true" tabindex="-1"></a>| Transportation and Mobility | Median Commute Time                              | <span class="co">[</span><span class="ot">HUD LAI</span><span class="co">](https://hudgis-hud.opendata.arcgis.com/datasets/location-affordability-index-v-3)</span> |</span>
<span id="cb94-87"><a href="#cb94-87" aria-hidden="true" tabindex="-1"></a>| Transportation and Mobility | Public Transit Use (Journey to work)             | <span class="co">[</span><span class="ot">HUD LAI</span><span class="co">](https://hudgis-hud.opendata.arcgis.com/datasets/location-affordability-index-v-3)</span> |</span>
<span id="cb94-88"><a href="#cb94-88" aria-hidden="true" tabindex="-1"></a>| Public Health and Safety    | NATA Cancer Risk Index                           | <span class="co">[</span><span class="ot">EPA EJSCREEN (2022)</span><span class="co">](https://www.epa.gov/ejscreen/download-ejscreen-data)</span>                  |</span>
<span id="cb94-89"><a href="#cb94-89" aria-hidden="true" tabindex="-1"></a>| Public Health and Safety    | NATA Respiratory Hazard Index                    | <span class="co">[</span><span class="ot">EPA EJSCREEN (2022)</span><span class="co">](https://www.epa.gov/ejscreen/download-ejscreen-data)</span>                  |</span>
<span id="cb94-90"><a href="#cb94-90" aria-hidden="true" tabindex="-1"></a>| Public Health and Safety    | Traffic Proximity and Volume                     | <span class="co">[</span><span class="ot">EPA EJSCREEN (2022)</span><span class="co">](https://www.epa.gov/ejscreen/download-ejscreen-data)</span>                  |</span>
<span id="cb94-91"><a href="#cb94-91" aria-hidden="true" tabindex="-1"></a>| Public Health and Safety    | Particulate Matter                               | <span class="co">[</span><span class="ot">EPA EJSCREEN(2022)</span><span class="co">](https://www.epa.gov/ejscreen/download-ejscreen-data)</span>                   |</span>
<span id="cb94-92"><a href="#cb94-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-93"><a href="#cb94-93" aria-hidden="true" tabindex="-1"></a>I have provided download links for the EJSCREEN and LAI data. We will use <span class="in">`tidycensus`</span> to load ACS data.</span>
<span id="cb94-94"><a href="#cb94-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-95"><a href="#cb94-95" aria-hidden="true" tabindex="-1"></a><span class="fu">### ACS Data</span></span>
<span id="cb94-96"><a href="#cb94-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-97"><a href="#cb94-97" aria-hidden="true" tabindex="-1"></a>Let's start by loading some ACS data:</span>
<span id="cb94-98"><a href="#cb94-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-101"><a href="#cb94-101" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-102"><a href="#cb94-102" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb94-103"><a href="#cb94-103" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb94-104"><a href="#cb94-104" aria-hidden="true" tabindex="-1"></a>DL_Year<span class="ot">&lt;-</span><span class="dv">2020</span></span>
<span id="cb94-105"><a href="#cb94-105" aria-hidden="true" tabindex="-1"></a>survey <span class="ot">&lt;-</span> <span class="st">"acs5"</span></span>
<span id="cb94-106"><a href="#cb94-106" aria-hidden="true" tabindex="-1"></a>state<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"NY"</span>)</span>
<span id="cb94-107"><a href="#cb94-107" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"09_placeopportunity/scripts/1_Get_ACS.R"</span>)</span>
<span id="cb94-108"><a href="#cb94-108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-109"><a href="#cb94-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-112"><a href="#cb94-112" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-113"><a href="#cb94-113" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb94-114"><a href="#cb94-114" aria-hidden="true" tabindex="-1"></a>DL_Year<span class="ot">&lt;-</span><span class="dv">2020</span></span>
<span id="cb94-115"><a href="#cb94-115" aria-hidden="true" tabindex="-1"></a>survey <span class="ot">&lt;-</span> <span class="st">"acs5"</span></span>
<span id="cb94-116"><a href="#cb94-116" aria-hidden="true" tabindex="-1"></a>state<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"NY"</span>)</span>
<span id="cb94-117"><a href="#cb94-117" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"scripts/1_Get_ACS.R"</span>)</span>
<span id="cb94-118"><a href="#cb94-118" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-119"><a href="#cb94-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-120"><a href="#cb94-120" aria-hidden="true" tabindex="-1"></a>This should look familiar - we have a script kept in the scripts folder with general code to download selected variables from the American Community Survey. Rather than placing this code in our notebook, we can use the <span class="in">`source()`</span> command to run the script in its entirety. We are defining the variables (api_key, DL_Year, survey, state) in our notebook, so that these can be referenced when the script is running.</span>
<span id="cb94-121"><a href="#cb94-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-122"><a href="#cb94-122" aria-hidden="true" tabindex="-1"></a>We have downloaded a lot of ACS data here at the census tract level for all tracts in Illinois:</span>
<span id="cb94-123"><a href="#cb94-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-124"><a href="#cb94-124" aria-hidden="true" tabindex="-1"></a>| Table  | Description             |</span>
<span id="cb94-125"><a href="#cb94-125" aria-hidden="true" tabindex="-1"></a>|--------|-------------------------|</span>
<span id="cb94-126"><a href="#cb94-126" aria-hidden="true" tabindex="-1"></a>| B01001 | Age and Population      |</span>
<span id="cb94-127"><a href="#cb94-127" aria-hidden="true" tabindex="-1"></a>| B02001 | Race                    |</span>
<span id="cb94-128"><a href="#cb94-128" aria-hidden="true" tabindex="-1"></a>| B03001 | Ethnicity               |</span>
<span id="cb94-129"><a href="#cb94-129" aria-hidden="true" tabindex="-1"></a>| B05002 | Foreign Born            |</span>
<span id="cb94-130"><a href="#cb94-130" aria-hidden="true" tabindex="-1"></a>| B11001 | Female Headed Household |</span>
<span id="cb94-131"><a href="#cb94-131" aria-hidden="true" tabindex="-1"></a>| B17001 | Poverty Rate            |</span>
<span id="cb94-132"><a href="#cb94-132" aria-hidden="true" tabindex="-1"></a>| B19013 | Median Household Income |</span>
<span id="cb94-133"><a href="#cb94-133" aria-hidden="true" tabindex="-1"></a>| B25002 | Residential Vacancy     |</span>
<span id="cb94-134"><a href="#cb94-134" aria-hidden="true" tabindex="-1"></a>| B25003 | Housing Tenure          |</span>
<span id="cb94-135"><a href="#cb94-135" aria-hidden="true" tabindex="-1"></a>| B25077 | Median Home Value       |</span>
<span id="cb94-136"><a href="#cb94-136" aria-hidden="true" tabindex="-1"></a>| B25106 | Housing Cost Burden     |</span>
<span id="cb94-137"><a href="#cb94-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-138"><a href="#cb94-138" aria-hidden="true" tabindex="-1"></a>I went ahead and turned this raw data into some selected indicators:</span>
<span id="cb94-139"><a href="#cb94-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-140"><a href="#cb94-140" aria-hidden="true" tabindex="-1"></a>| Table  | Label        | Description                                           |</span>
<span id="cb94-141"><a href="#cb94-141" aria-hidden="true" tabindex="-1"></a>|------------------|------------------|-------------------------------------|</span>
<span id="cb94-142"><a href="#cb94-142" aria-hidden="true" tabindex="-1"></a>| B01001 | under18      | Proportion of Population under 18                     |</span>
<span id="cb94-143"><a href="#cb94-143" aria-hidden="true" tabindex="-1"></a>| B01001 | over65       | Proportion of Population over 65                      |</span>
<span id="cb94-144"><a href="#cb94-144" aria-hidden="true" tabindex="-1"></a>| B01001 | P_Female     | Proportion of Population female                       |</span>
<span id="cb94-145"><a href="#cb94-145" aria-hidden="true" tabindex="-1"></a>| B01001 | Pop          | Total Population size                                 |</span>
<span id="cb94-146"><a href="#cb94-146" aria-hidden="true" tabindex="-1"></a>| B02001 | PWhite       | Proportion Population White                           |</span>
<span id="cb94-147"><a href="#cb94-147" aria-hidden="true" tabindex="-1"></a>| B02001 | PBlack       | Proportion Population Black                           |</span>
<span id="cb94-148"><a href="#cb94-148" aria-hidden="true" tabindex="-1"></a>| B02001 | PAIAN        | Proportion Population AIAN                            |</span>
<span id="cb94-149"><a href="#cb94-149" aria-hidden="true" tabindex="-1"></a>| B02001 | PAsian       | Proportion Population Asian                           |</span>
<span id="cb94-150"><a href="#cb94-150" aria-hidden="true" tabindex="-1"></a>| B02001 | PNonwhite    | Proportion Population Nonwhite                        |</span>
<span id="cb94-151"><a href="#cb94-151" aria-hidden="true" tabindex="-1"></a>| B03001 | PLatino      | Proportion Population Latino Ethnicity (Of all Races) |</span>
<span id="cb94-152"><a href="#cb94-152" aria-hidden="true" tabindex="-1"></a>| B05002 | PForeignborn | Proportion Population Foreign Born                    |</span>
<span id="cb94-153"><a href="#cb94-153" aria-hidden="true" tabindex="-1"></a>| B19013 | MHHI         | Median Household Income                               |</span>
<span id="cb94-154"><a href="#cb94-154" aria-hidden="true" tabindex="-1"></a>| B11001 | P_FHHH       | Proportion Female Headed Households                   |</span>
<span id="cb94-155"><a href="#cb94-155" aria-hidden="true" tabindex="-1"></a>| B17001 | Pov          | Proportion Households Below Poverty                   |</span>
<span id="cb94-156"><a href="#cb94-156" aria-hidden="true" tabindex="-1"></a>| B25003 | P_Own        | Proportion Owner Occupied Housing Units               |</span>
<span id="cb94-157"><a href="#cb94-157" aria-hidden="true" tabindex="-1"></a>| B25077 | MHV          | Median Home Value                                     |</span>
<span id="cb94-158"><a href="#cb94-158" aria-hidden="true" tabindex="-1"></a>| B25106 | CostBurden   | Housing Cost Burden                                   |</span>
<span id="cb94-159"><a href="#cb94-159" aria-hidden="true" tabindex="-1"></a>| B25002 | Rvac         | Residential Vacancy Rate                              |</span>
<span id="cb94-160"><a href="#cb94-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-161"><a href="#cb94-161" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Join ACS Data</span></span>
<span id="cb94-162"><a href="#cb94-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-163"><a href="#cb94-163" aria-hidden="true" tabindex="-1"></a>Now that we have these individual tables downloaded, we need to combine these together into a single dataset. We've done this many times in the past using <span class="in">`left_join()`</span> but only with respect to two datasets at a time. Let's introduce an alternative strategy here, using the purrr package's <span class="in">`reduce()`</span> function combined with <span class="in">`left_join()`</span>.</span>
<span id="cb94-164"><a href="#cb94-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-165"><a href="#cb94-165" aria-hidden="true" tabindex="-1"></a>First, here's the way we might accomplish this as we have in the past:</span>
<span id="cb94-166"><a href="#cb94-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-169"><a href="#cb94-169" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-170"><a href="#cb94-170" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb94-171"><a href="#cb94-171" aria-hidden="true" tabindex="-1"></a>acs_data<span class="ot">&lt;-</span><span class="fu">left_join</span>(B01001, B02001, <span class="at">by=</span><span class="st">"GEOID"</span>)</span>
<span id="cb94-172"><a href="#cb94-172" aria-hidden="true" tabindex="-1"></a>acs_data<span class="ot">&lt;-</span><span class="fu">left_join</span>(acs_data, B03001, <span class="at">by=</span><span class="st">"GEOID"</span>)</span>
<span id="cb94-173"><a href="#cb94-173" aria-hidden="true" tabindex="-1"></a>acs_data<span class="ot">&lt;-</span><span class="fu">left_join</span>(acs_data, B05002, <span class="at">by=</span><span class="st">"GEOID"</span>)</span>
<span id="cb94-174"><a href="#cb94-174" aria-hidden="true" tabindex="-1"></a>acs_data<span class="ot">&lt;-</span><span class="fu">left_join</span>(acs_data, B11001, <span class="at">by=</span><span class="st">"GEOID"</span>)</span>
<span id="cb94-175"><a href="#cb94-175" aria-hidden="true" tabindex="-1"></a>acs_data<span class="ot">&lt;-</span><span class="fu">left_join</span>(acs_data, B17001, <span class="at">by=</span><span class="st">"GEOID"</span>)</span>
<span id="cb94-176"><a href="#cb94-176" aria-hidden="true" tabindex="-1"></a>acs_data<span class="ot">&lt;-</span><span class="fu">left_join</span>(acs_data, B19013, <span class="at">by=</span><span class="st">"GEOID"</span>)</span>
<span id="cb94-177"><a href="#cb94-177" aria-hidden="true" tabindex="-1"></a>acs_data<span class="ot">&lt;-</span><span class="fu">left_join</span>(acs_data, B25002, <span class="at">by=</span><span class="st">"GEOID"</span>)</span>
<span id="cb94-178"><a href="#cb94-178" aria-hidden="true" tabindex="-1"></a>acs_data<span class="ot">&lt;-</span><span class="fu">left_join</span>(acs_data, B25003, <span class="at">by=</span><span class="st">"GEOID"</span>)</span>
<span id="cb94-179"><a href="#cb94-179" aria-hidden="true" tabindex="-1"></a>acs_data<span class="ot">&lt;-</span><span class="fu">left_join</span>(acs_data, B25077, <span class="at">by=</span><span class="st">"GEOID"</span>)</span>
<span id="cb94-180"><a href="#cb94-180" aria-hidden="true" tabindex="-1"></a>acs_data<span class="ot">&lt;-</span><span class="fu">left_join</span>(acs_data, B25106, <span class="at">by=</span><span class="st">"GEOID"</span>)</span>
<span id="cb94-181"><a href="#cb94-181" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-182"><a href="#cb94-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-183"><a href="#cb94-183" aria-hidden="true" tabindex="-1"></a>This works just fine, but there's a lot of repition of code here with so many data frames.</span>
<span id="cb94-184"><a href="#cb94-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-185"><a href="#cb94-185" aria-hidden="true" tabindex="-1"></a>Now let's look at how we can implement the same thing using <span class="in">`reduce()`</span>:</span>
<span id="cb94-186"><a href="#cb94-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-189"><a href="#cb94-189" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-190"><a href="#cb94-190" aria-hidden="true" tabindex="-1"></a>acs_data <span class="ot">&lt;-</span> <span class="fu">list</span>(B01001, B02001, B03001, B05002, B11001, B17001, B19013, B25002, B25003, B25077, B25106) <span class="sc">|&gt;</span> </span>
<span id="cb94-191"><a href="#cb94-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(left_join, <span class="at">by =</span> <span class="st">"GEOID"</span>)</span>
<span id="cb94-192"><a href="#cb94-192" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-193"><a href="#cb94-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-194"><a href="#cb94-194" aria-hidden="true" tabindex="-1"></a>In this case, we create a list containing each of the data frames we want to join together (note that we don't put these in quotes since they're objects and not names). We then use the <span class="in">`reduce()`</span> command and tell reduce that we want to perform a left join and also supply the common variable name.</span>
<span id="cb94-195"><a href="#cb94-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-196"><a href="#cb94-196" aria-hidden="true" tabindex="-1"></a>But what is <span class="in">`reduce()`</span> really doing here? If you look at it's documentation (<span class="in">`?reduce`</span>), you'll see that:</span>
<span id="cb94-197"><a href="#cb94-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-198"><a href="#cb94-198" aria-hidden="true" tabindex="-1"></a><span class="in">`reduce()`</span> is an operation that combines elements of a vector into a single value. The combination is driven by .f, a binary function, and takes two values and returns a single value: Reducing f over 1:3 computes the values f(f(1,2), 3).</span>
<span id="cb94-199"><a href="#cb94-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-200"><a href="#cb94-200" aria-hidden="true" tabindex="-1"></a>So if we are doing a left join, this is essentially doing the following:</span>
<span id="cb94-201"><a href="#cb94-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-204"><a href="#cb94-204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-205"><a href="#cb94-205" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb94-206"><a href="#cb94-206" aria-hidden="true" tabindex="-1"></a>acs_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(df1, df2)</span>
<span id="cb94-207"><a href="#cb94-207" aria-hidden="true" tabindex="-1"></a>acs_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(acs_data, df3)</span>
<span id="cb94-208"><a href="#cb94-208" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-209"><a href="#cb94-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-210"><a href="#cb94-210" aria-hidden="true" tabindex="-1"></a>And on and on until reduce has iterated through all elements of the list. This helps us cut down on repititious code.</span>
<span id="cb94-211"><a href="#cb94-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-212"><a href="#cb94-212" aria-hidden="true" tabindex="-1"></a>Inspecting our handiwork, our acs_data table (for which we downloaded tract-level data for New York state has 5,411 observations and 19 variables:</span>
<span id="cb94-213"><a href="#cb94-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-216"><a href="#cb94-216" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-217"><a href="#cb94-217" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(acs_data)</span>
<span id="cb94-218"><a href="#cb94-218" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-219"><a href="#cb94-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-220"><a href="#cb94-220" aria-hidden="true" tabindex="-1"></a>While we're at it, let's do a little cleaning up. We have a lot of data frames which are now consolidated into acs_data. We can delete other objects from our environment using <span class="in">`rm()`</span></span>
<span id="cb94-221"><a href="#cb94-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-224"><a href="#cb94-224" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-225"><a href="#cb94-225" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(B01001, B02001, B03001, B05002, B11001, B17001, B19013, B25002, B25003, B25077, B25106)</span>
<span id="cb94-226"><a href="#cb94-226" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-227"><a href="#cb94-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-228"><a href="#cb94-228" aria-hidden="true" tabindex="-1"></a><span class="fu">### LAI Data</span></span>
<span id="cb94-229"><a href="#cb94-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-230"><a href="#cb94-230" aria-hidden="true" tabindex="-1"></a>Let's download the HUD LAI data from <span class="co">[</span><span class="ot">here</span><span class="co">](https://opendata.arcgis.com/datasets/b7ffe3607e8c4212bf7cf2428208dbb6_0.csv)</span>. Readr can read this directly from the download URL:</span>
<span id="cb94-231"><a href="#cb94-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-234"><a href="#cb94-234" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-235"><a href="#cb94-235" aria-hidden="true" tabindex="-1"></a>LAI <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://opendata.arcgis.com/datasets/b7ffe3607e8c4212bf7cf2428208dbb6_0.csv"</span>)</span>
<span id="cb94-236"><a href="#cb94-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-237"><a href="#cb94-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-238"><a href="#cb94-238" aria-hidden="true" tabindex="-1"></a>Let's go ahead and select the following variables (our variables of interest) and overwrite the initial file:</span>
<span id="cb94-239"><a href="#cb94-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-240"><a href="#cb94-240" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>GEOID</span>
<span id="cb94-241"><a href="#cb94-241" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>pct_transit_j2w</span>
<span id="cb94-242"><a href="#cb94-242" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>median_gross_rent</span>
<span id="cb94-243"><a href="#cb94-243" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>pct_hu_1<span class="sc">\_</span>detatched</span>
<span id="cb94-244"><a href="#cb94-244" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>job_density_simple</span>
<span id="cb94-245"><a href="#cb94-245" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>retail_density_simple</span>
<span id="cb94-246"><a href="#cb94-246" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>median_commute</span>
<span id="cb94-247"><a href="#cb94-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-250"><a href="#cb94-250" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-251"><a href="#cb94-251" aria-hidden="true" tabindex="-1"></a>LAI<span class="ot">&lt;-</span>LAI <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, </span>
<span id="cb94-252"><a href="#cb94-252" aria-hidden="true" tabindex="-1"></a>                    STUSAB,</span>
<span id="cb94-253"><a href="#cb94-253" aria-hidden="true" tabindex="-1"></a>                    pct_transit_j2w,</span>
<span id="cb94-254"><a href="#cb94-254" aria-hidden="true" tabindex="-1"></a>                    median_gross_rent,</span>
<span id="cb94-255"><a href="#cb94-255" aria-hidden="true" tabindex="-1"></a>                    pct_hu_1_detached,</span>
<span id="cb94-256"><a href="#cb94-256" aria-hidden="true" tabindex="-1"></a>                    job_density_simple,</span>
<span id="cb94-257"><a href="#cb94-257" aria-hidden="true" tabindex="-1"></a>                    retail_density_simple,</span>
<span id="cb94-258"><a href="#cb94-258" aria-hidden="true" tabindex="-1"></a>                    median_commute</span>
<span id="cb94-259"><a href="#cb94-259" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb94-260"><a href="#cb94-260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-261"><a href="#cb94-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-262"><a href="#cb94-262" aria-hidden="true" tabindex="-1"></a><span class="fu">### EJSCREEN Data</span></span>
<span id="cb94-263"><a href="#cb94-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-264"><a href="#cb94-264" aria-hidden="true" tabindex="-1"></a>We can download the EJSCREEN data <span class="co">[</span><span class="ot">here</span><span class="co">](https://gaftp.epa.gov/EJSCREEN/2020/)</span>. Unlike the LAI data which we could read directly from the .csv file, the EJSCREEN data will need to be downloaded and unzipped before it can be used.</span>
<span id="cb94-265"><a href="#cb94-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-266"><a href="#cb94-266" aria-hidden="true" tabindex="-1"></a>We'll use the <span class="in">`read_csv()`</span> function from the <span class="in">`readr`</span> package to load raw EJSCREEN data, located in the "data" folder. Load these into an object called "ejscreen":</span>
<span id="cb94-267"><a href="#cb94-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-270"><a href="#cb94-270" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-271"><a href="#cb94-271" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb94-272"><a href="#cb94-272" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb94-273"><a href="#cb94-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-274"><a href="#cb94-274" aria-hidden="true" tabindex="-1"></a>ejscreen<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">"09_placeopportunity/data_raw/EJSCREEN_2020_StatePctile.csv"</span>)</span>
<span id="cb94-275"><a href="#cb94-275" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-276"><a href="#cb94-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-277"><a href="#cb94-277" aria-hidden="true" tabindex="-1"></a>Inspect the data. Let's select a subset of the variables in the data which we'll work more with. Based upon our framework, we'll select the following variables and overwrite the original ejscreen object with our selection:</span>
<span id="cb94-278"><a href="#cb94-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-279"><a href="#cb94-279" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>ID</span>
<span id="cb94-280"><a href="#cb94-280" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>ACSTOTPOP</span>
<span id="cb94-281"><a href="#cb94-281" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>CANCER</span>
<span id="cb94-282"><a href="#cb94-282" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>RESP</span>
<span id="cb94-283"><a href="#cb94-283" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>PTRAF</span>
<span id="cb94-284"><a href="#cb94-284" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>PM25</span>
<span id="cb94-285"><a href="#cb94-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-288"><a href="#cb94-288" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-289"><a href="#cb94-289" aria-hidden="true" tabindex="-1"></a>ejscreen<span class="ot">&lt;-</span>ejscreen <span class="sc">|&gt;</span> </span>
<span id="cb94-290"><a href="#cb94-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID,</span>
<span id="cb94-291"><a href="#cb94-291" aria-hidden="true" tabindex="-1"></a>        ACSTOTPOP,</span>
<span id="cb94-292"><a href="#cb94-292" aria-hidden="true" tabindex="-1"></a>        CANCER,</span>
<span id="cb94-293"><a href="#cb94-293" aria-hidden="true" tabindex="-1"></a>        RESP,</span>
<span id="cb94-294"><a href="#cb94-294" aria-hidden="true" tabindex="-1"></a>        PTRAF,</span>
<span id="cb94-295"><a href="#cb94-295" aria-hidden="true" tabindex="-1"></a>        PM25)</span>
<span id="cb94-296"><a href="#cb94-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-297"><a href="#cb94-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-298"><a href="#cb94-298" aria-hidden="true" tabindex="-1"></a><span class="fu">## Joining the Three Datasets</span></span>
<span id="cb94-299"><a href="#cb94-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-300"><a href="#cb94-300" aria-hidden="true" tabindex="-1"></a>Ok - we're getting somewhere, I promise! We now have three datasets - acs_data, which contains tract-level data for New York state, LAI which contains *tract-level data* for the entire US, and ejscreen which contains *block group level data* for the US. We're so close to joining these together and indexing the data!</span>
<span id="cb94-301"><a href="#cb94-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-302"><a href="#cb94-302" aria-hidden="true" tabindex="-1"></a><span class="fu">### Creating Tract Data from Block Groups</span></span>
<span id="cb94-303"><a href="#cb94-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-304"><a href="#cb94-304" aria-hidden="true" tabindex="-1"></a>One thing, though - we need to convert our ejscreen block groups data into tracts. Block groups are geographic subdivisions of tracts. Fortunately for us, Census FIPS codes are hierarchical - the combined state-county-tract-blockgroup variable called "ID" in ejscreen contains the tract FIPS code: - State (2 characters) - County (3 characters) - Tract (6 characters) - Block Group (1 character)</span>
<span id="cb94-305"><a href="#cb94-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-306"><a href="#cb94-306" aria-hidden="true" tabindex="-1"></a>Ok, this is all well and good - how do we use this knowledge to combine things together? We could simply average the block group values together to approximate a tract-level average. At the same time, block groups are likely to have different populations. Given this potential heterogeneity, let's use the population weighted average of those block group characteristics to constitute our tract characteristics.</span>
<span id="cb94-307"><a href="#cb94-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-308"><a href="#cb94-308" aria-hidden="true" tabindex="-1"></a>To aggregate our block group data, we need to extract the tract characters from the ID column, and then we can <span class="in">`group_by()`</span> and <span class="in">`summarise`</span> our data based upon the tract FIPS code. Base R fortunately has a function called <span class="in">`substr()`</span> (substring) which can handle the extraction for us:</span>
<span id="cb94-309"><a href="#cb94-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-312"><a href="#cb94-312" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-313"><a href="#cb94-313" aria-hidden="true" tabindex="-1"></a>ejscreen<span class="ot">&lt;-</span>ejscreen <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">GEOID =</span> <span class="fu">substr</span>(ID, <span class="dv">0</span>, <span class="dv">11</span>))</span>
<span id="cb94-314"><a href="#cb94-314" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-315"><a href="#cb94-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-316"><a href="#cb94-316" aria-hidden="true" tabindex="-1"></a>What happened here? We're creating a new column called GEOID, and then invoking substr. We tell that function that we want a substring from the ID field, and then we say 0, 11, where 0 is the first position if we were counting from the left of the first character in the ID variable, and 11 is the last character that we want (remember, the combined FIPS code is 12 characters long, and we want all but the last character).</span>
<span id="cb94-317"><a href="#cb94-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-318"><a href="#cb94-318" aria-hidden="true" tabindex="-1"></a>And now we can use <span class="in">`group_by()`</span> and <span class="in">`summarise()`</span> to group together the data into census tract level aggregates. We can use <span class="in">`weighted.mean()`</span> to calculate... weight for it... the weighted average (professor humor)! GEOID contains our combined state-county-tract FIPS code, ACSTOTPOP contains out population for the purpose of weighting, and we want to calculate averages for CANCER, RESP, PTRAF, and PM25. Figure out how to get that done.</span>
<span id="cb94-319"><a href="#cb94-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-320"><a href="#cb94-320" aria-hidden="true" tabindex="-1"></a>Sneak preview - you're going to hit an error - think about what rows might need to be removed to calculate a weighted average:</span>
<span id="cb94-321"><a href="#cb94-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-324"><a href="#cb94-324" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-325"><a href="#cb94-325" aria-hidden="true" tabindex="-1"></a>ejscreen<span class="ot">&lt;-</span>ejscreen <span class="sc">%&gt;%</span> </span>
<span id="cb94-326"><a href="#cb94-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ACSTOTPOP <span class="sc">!=</span> <span class="dv">0</span>, CANCER <span class="sc">!=</span> <span class="st">"None"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb94-327"><a href="#cb94-327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID) <span class="sc">%&gt;%</span> </span>
<span id="cb94-328"><a href="#cb94-328" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb94-329"><a href="#cb94-329" aria-hidden="true" tabindex="-1"></a>  <span class="at">CANCER =</span> <span class="fu">weighted.mean</span>(<span class="fu">as.numeric</span>(CANCER), ACSTOTPOP),</span>
<span id="cb94-330"><a href="#cb94-330" aria-hidden="true" tabindex="-1"></a>  <span class="at">RESP =</span> <span class="fu">weighted.mean</span>(<span class="fu">as.numeric</span>(RESP), ACSTOTPOP),</span>
<span id="cb94-331"><a href="#cb94-331" aria-hidden="true" tabindex="-1"></a>  <span class="at">PTRAF =</span> <span class="fu">weighted.mean</span>(PTRAF, ACSTOTPOP),</span>
<span id="cb94-332"><a href="#cb94-332" aria-hidden="true" tabindex="-1"></a>  <span class="at">PM25 =</span> <span class="fu">weighted.mean</span>(<span class="fu">as.numeric</span>(PM25), ACSTOTPOP))</span>
<span id="cb94-333"><a href="#cb94-333" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-334"><a href="#cb94-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-335"><a href="#cb94-335" aria-hidden="true" tabindex="-1"></a>Ok - now we have around 73,000 tract-level observations for the EPA data - not too far off from what we have for the LAI data. Both of these datasets include observations for the entire US, while our ACS data only contains observations for New York State. Using your newfound knowledge of how to join data together based upon a common column, create a new object named dataset which contains combined ACS, ejscreen, and LAI data for Illinois census tracts:</span>
<span id="cb94-336"><a href="#cb94-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-339"><a href="#cb94-339" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-340"><a href="#cb94-340" aria-hidden="true" tabindex="-1"></a>dataset<span class="ot">&lt;-</span> <span class="fu">list</span>(acs_data,  LAI, ejscreen) <span class="sc">|&gt;</span> <span class="fu">reduce</span>(left_join, <span class="at">by=</span><span class="st">"GEOID"</span>)</span>
<span id="cb94-341"><a href="#cb94-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-342"><a href="#cb94-342" aria-hidden="true" tabindex="-1"></a>dataset <span class="sc">|&gt;</span> <span class="fu">head</span>() <span class="sc">|&gt;</span> <span class="fu">gt</span>()</span>
<span id="cb94-343"><a href="#cb94-343" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-344"><a href="#cb94-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-345"><a href="#cb94-345" aria-hidden="true" tabindex="-1"></a>Now that we have our base dataset together, we can filter to our area of interest, in this case, the boroughs that make up New York City:</span>
<span id="cb94-346"><a href="#cb94-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-347"><a href="#cb94-347" aria-hidden="true" tabindex="-1"></a>| FIPS Code | County Name     | Borough Name  |</span>
<span id="cb94-348"><a href="#cb94-348" aria-hidden="true" tabindex="-1"></a>|-----------|-----------------|---------------|</span>
<span id="cb94-349"><a href="#cb94-349" aria-hidden="true" tabindex="-1"></a>| 36047     | Kings County    | Brooklyn      |</span>
<span id="cb94-350"><a href="#cb94-350" aria-hidden="true" tabindex="-1"></a>| 36005     | Bronx County    | Bronx         |</span>
<span id="cb94-351"><a href="#cb94-351" aria-hidden="true" tabindex="-1"></a>| 36081     | Queens County   | Queens        |</span>
<span id="cb94-352"><a href="#cb94-352" aria-hidden="true" tabindex="-1"></a>| 36085     | Richmond County | Staten Island |</span>
<span id="cb94-353"><a href="#cb94-353" aria-hidden="true" tabindex="-1"></a>| 36061     | New York County | Manhattan     |</span>
<span id="cb94-354"><a href="#cb94-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-357"><a href="#cb94-357" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-358"><a href="#cb94-358" aria-hidden="true" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> dataset <span class="sc">|&gt;</span> </span>
<span id="cb94-359"><a href="#cb94-359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">substr</span>(GEOID, <span class="dv">0</span>, <span class="dv">5</span>) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"36047"</span>, <span class="st">"36005"</span>, <span class="st">"36081"</span>, <span class="st">"36085"</span>, <span class="st">"36061"</span>))</span>
<span id="cb94-360"><a href="#cb94-360" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-361"><a href="#cb94-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-362"><a href="#cb94-362" aria-hidden="true" tabindex="-1"></a>The above code uses <span class="in">`substr()`</span> to pull out the first 5 characters from the GEOID field (the combined state and county FIPS codes) and then matches them against the FIPS codes for the five boroughs of New York City.</span>
<span id="cb94-363"><a href="#cb94-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-364"><a href="#cb94-364" aria-hidden="true" tabindex="-1"></a><span class="fu">## Create Standardized Scores</span></span>
<span id="cb94-365"><a href="#cb94-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-366"><a href="#cb94-366" aria-hidden="true" tabindex="-1"></a>Remembering back to your high school or college statistics class, a Z-score (or standardized score) can be be calculated by subtracting from a given observation the mean of all observations and then dividing by the standard deviation of all observations.</span>
<span id="cb94-367"><a href="#cb94-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-368"><a href="#cb94-368" aria-hidden="true" tabindex="-1"></a>Recall:</span>
<span id="cb94-369"><a href="#cb94-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-370"><a href="#cb94-370" aria-hidden="true" tabindex="-1"></a>$z = \frac{x-\mu}{\sigma}$ where: $x$ is the individual observation we want to standardize $\mu$ is the population mean $\sigma$ is the population standard deviation</span>
<span id="cb94-371"><a href="#cb94-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-372"><a href="#cb94-372" aria-hidden="true" tabindex="-1"></a>Find the mean and standard deviation for a variable in our dataset and manually calculate a z-score (just for fun).</span>
<span id="cb94-373"><a href="#cb94-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-376"><a href="#cb94-376" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-377"><a href="#cb94-377" aria-hidden="true" tabindex="-1"></a>dataset <span class="sc">|&gt;</span> </span>
<span id="cb94-378"><a href="#cb94-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb94-379"><a href="#cb94-379" aria-hidden="true" tabindex="-1"></a>  <span class="at">under18_mean =</span> <span class="fu">mean</span>(under18, <span class="at">na.rm=</span><span class="cn">TRUE</span>), </span>
<span id="cb94-380"><a href="#cb94-380" aria-hidden="true" tabindex="-1"></a>  <span class="at">under18_sd =</span> <span class="fu">sd</span>(under18, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb94-381"><a href="#cb94-381" aria-hidden="true" tabindex="-1"></a>  <span class="at">z_under18 =</span> (under18 <span class="sc">-</span> under18_mean)<span class="sc">/</span>under18_sd</span>
<span id="cb94-382"><a href="#cb94-382" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb94-383"><a href="#cb94-383" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-384"><a href="#cb94-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-385"><a href="#cb94-385" aria-hidden="true" tabindex="-1"></a>For the first observation, the value for Under 18 is 27.9 percent. The average value for tracts in Illinois is 27.9 percent, and the standard deviation is 7.73. The standardized score of .960 indicates that the observation is .96 of a standard deviation above the mean. There's absolutely nothing wrong with doing this manually, however, we can use the <span class="in">`scale()`</span> function to do the same thing:</span>
<span id="cb94-386"><a href="#cb94-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-389"><a href="#cb94-389" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-390"><a href="#cb94-390" aria-hidden="true" tabindex="-1"></a>dataset <span class="sc">|&gt;</span>  <span class="fu">mutate</span>(<span class="at">under18 =</span> <span class="fu">scale</span>(under18))</span>
<span id="cb94-391"><a href="#cb94-391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-392"><a href="#cb94-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-393"><a href="#cb94-393" aria-hidden="true" tabindex="-1"></a>This brings up an important question - what should the reference geography be for our opportunity measures? We narrowed down our dataset to New York City, however, we could have just as easily used the state or the nation. It's important to keep in mind that once we construct Z-scores for our indicators, they are with reference to the distribiotn of values we choose to include. We are using the city of New York City as our point of reference. Using the state as a point of reference may be relevant and useful, especially if we want to make some comparisons across the state. At the same time, the characteristics of New York City and other metropolitan areas are likely to be very different than the balance of the state, and so comparisons for the purpose of standardizing our data may be a bit distorted. Now that we have our reference region selected, we can move forward with standardizing each indicator value.</span>
<span id="cb94-394"><a href="#cb94-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-395"><a href="#cb94-395" aria-hidden="true" tabindex="-1"></a>Before we do this, it can be useful to provide a more intuitive description of each variable (since most people do not think about indicators in standardized terms). You may recall us previously using commands like <span class="in">`summary()`</span> for basic descriptives.</span>
<span id="cb94-396"><a href="#cb94-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-397"><a href="#cb94-397" aria-hidden="true" tabindex="-1"></a>We're going to use a variant of the <span class="in">`summarise`</span> command which you've used in the past. <span class="in">`summarise_at()`</span> allows us to select variables to summarise by their name, and will then apply the same function across all of those variables. Let's find the mean for each of the indicator variables in our compiled dataset:</span>
<span id="cb94-398"><a href="#cb94-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-401"><a href="#cb94-401" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-402"><a href="#cb94-402" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb94-403"><a href="#cb94-403" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb94-404"><a href="#cb94-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-405"><a href="#cb94-405" aria-hidden="true" tabindex="-1"></a>dataset <span class="sc">|&gt;</span> </span>
<span id="cb94-406"><a href="#cb94-406" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_at</span>(<span class="fu">vars</span>(under18<span class="sc">:</span>median_commute), mean, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb94-407"><a href="#cb94-407" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-408"><a href="#cb94-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-409"><a href="#cb94-409" aria-hidden="true" tabindex="-1"></a>We use <span class="in">`vars()`</span> to specify the variables to summarize by their name, using the colon to specify through (e.g. under18 through median_commute). We specify that we want our summary statistic to be the mean, and we specify that we want to remove NAs so we get a usable statistic out. This gives us some usable statistics for the entire region. We might also want to derive summaries for each of the counties in the region - how could we do this using your knowledge of <span class="in">`group_by()`</span>, <span class="in">`substr()`</span>, and <span class="in">`summarise_at()`</span>?</span>
<span id="cb94-410"><a href="#cb94-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-413"><a href="#cb94-413" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-414"><a href="#cb94-414" aria-hidden="true" tabindex="-1"></a>dataset <span class="sc">|&gt;</span> </span>
<span id="cb94-415"><a href="#cb94-415" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">substr</span>(GEOID, <span class="dv">0</span>, <span class="dv">5</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb94-416"><a href="#cb94-416" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_at</span>(<span class="fu">vars</span>(under18<span class="sc">:</span>median_commute), mean, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb94-417"><a href="#cb94-417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-418"><a href="#cb94-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-419"><a href="#cb94-419" aria-hidden="true" tabindex="-1"></a>You can start to see some of the differences that exist between distributions at the borough (county) level. Do any stick out to you at this point?</span>
<span id="cb94-420"><a href="#cb94-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-421"><a href="#cb94-421" aria-hidden="true" tabindex="-1"></a>Ok, we have created a numeric summary table that may be useful for reporting out. Now we can produce our standardized scores which we can use for index making.</span>
<span id="cb94-422"><a href="#cb94-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-423"><a href="#cb94-423" aria-hidden="true" tabindex="-1"></a>Now that you have defined your region, described the data for your region, and know how to standardize the values, you can create a scaled version of your data. Earlier, we learned how to use <span class="in">`summarise_at()`</span> to select variables to summarize using a specific function. There's also a <span class="in">`mutate_at()`</span> function which allows you to perform the same alteration upon all of the variables you select. Take a look at the documentation for <span class="in">`mutate_at()`</span>. You'll need to supply the variables you want to mutate, as well as the function (read closely the documentation and examples before proceeding).</span>
<span id="cb94-424"><a href="#cb94-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-425"><a href="#cb94-425" aria-hidden="true" tabindex="-1"></a>Now let's go ahead and create a **separate** dataset called dataset_scaled which contains the scaled values (there may a few fields which either do not need scaling or who you can remove):</span>
<span id="cb94-426"><a href="#cb94-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-429"><a href="#cb94-429" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-430"><a href="#cb94-430" aria-hidden="true" tabindex="-1"></a>dataset_scaled<span class="ot">&lt;-</span>dataset <span class="sc">|&gt;</span>  </span>
<span id="cb94-431"><a href="#cb94-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(under18, over65, P_Female, PNonwhite, PForeignborn, P_FHHH, Pov, MHHI, P_Own, MHV, CostBurden, CANCER, RESP, PTRAF, PM25, pct_transit_j2w, median_gross_rent, pct_hu_1_detached, job_density_simple, retail_density_simple, median_commute), <span class="fu">list</span>(<span class="at">scale=</span>scale))</span>
<span id="cb94-432"><a href="#cb94-432" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-433"><a href="#cb94-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-434"><a href="#cb94-434" aria-hidden="true" tabindex="-1"></a>We are in the home stretch! We are very close to being able to make our index. We need to determine how we think each variable is related to opportunity. In some cases, higher values are "good", and in some cases, lower values are "good". We need to make sure that those values are all moving in the same direction so that when we combine them they do not counter-act each other.</span>
<span id="cb94-435"><a href="#cb94-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-436"><a href="#cb94-436" aria-hidden="true" tabindex="-1"></a>Below is a table proposing potential directions for each variable.</span>
<span id="cb94-437"><a href="#cb94-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-438"><a href="#cb94-438" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Negative:** For a variable labeled **Negative**, higher values are likely to indicate lower levels of opportunity.</span>
<span id="cb94-439"><a href="#cb94-439" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Positive:** Far a variable labeled **Positive**, higher values are likely to indicate higher levels of opportunity.</span>
<span id="cb94-440"><a href="#cb94-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-441"><a href="#cb94-441" aria-hidden="true" tabindex="-1"></a>| Variable              | Description                             | Relationship to Opportunity | Category               |</span>
<span id="cb94-442"><a href="#cb94-442" aria-hidden="true" tabindex="-1"></a>|----------------|------------------------|----------------|----------------|</span>
<span id="cb94-443"><a href="#cb94-443" aria-hidden="true" tabindex="-1"></a>| under18               | Proportion of Population under 18       | Negative                    | Demographic Structure  |</span>
<span id="cb94-444"><a href="#cb94-444" aria-hidden="true" tabindex="-1"></a>| over65                | Proportion of Population over 65        | Negative                    | Demographic Structure  |</span>
<span id="cb94-445"><a href="#cb94-445" aria-hidden="true" tabindex="-1"></a>| PNonwhite             | Proportion Population Nonwhite          | Negative                    | Demographic Structure  |</span>
<span id="cb94-446"><a href="#cb94-446" aria-hidden="true" tabindex="-1"></a>| PForeignborn          | Proportion Population Foreign Born      | Negative                    | Demographic Structure  |</span>
<span id="cb94-447"><a href="#cb94-447" aria-hidden="true" tabindex="-1"></a>| MHHI                  | Median Household Income                 | Positive                    | Employment and Economy |</span>
<span id="cb94-448"><a href="#cb94-448" aria-hidden="true" tabindex="-1"></a>| P_FHHH                | Proportion Female Headed Households     | Negative                    | Demographic Structure  |</span>
<span id="cb94-449"><a href="#cb94-449" aria-hidden="true" tabindex="-1"></a>| Pov                   | Proportion Households Below Poverty     | Negative                    | Demographic Structure  |</span>
<span id="cb94-450"><a href="#cb94-450" aria-hidden="true" tabindex="-1"></a>| P_Own                 | Proportion Owner Occupied Housing Units | Positive                    | Housing                |</span>
<span id="cb94-451"><a href="#cb94-451" aria-hidden="true" tabindex="-1"></a>| MHV                   | Median Home Value                       | Positive                    | Housing                |</span>
<span id="cb94-452"><a href="#cb94-452" aria-hidden="true" tabindex="-1"></a>| CostBurden            | Housing Cost Burden                     | Negative                    | Housing                |</span>
<span id="cb94-453"><a href="#cb94-453" aria-hidden="true" tabindex="-1"></a>| CANCER                | Cancer Risk Index                       | Negative                    | Environmental Health   |</span>
<span id="cb94-454"><a href="#cb94-454" aria-hidden="true" tabindex="-1"></a>| RESP                  | Respiratory Hazard Index                | Negative                    | Environmental Health   |</span>
<span id="cb94-455"><a href="#cb94-455" aria-hidden="true" tabindex="-1"></a>| PTRAF                 | Traffic Proximity Index                 | Negative                    | Environmental Health   |</span>
<span id="cb94-456"><a href="#cb94-456" aria-hidden="true" tabindex="-1"></a>| PM25                  | Particulate Matter Index                | Negative                    | Environmental Health   |</span>
<span id="cb94-457"><a href="#cb94-457" aria-hidden="true" tabindex="-1"></a>| pct_transit_j2w       | Commuting by Public Transportation      | Positive                    | Transportation         |</span>
<span id="cb94-458"><a href="#cb94-458" aria-hidden="true" tabindex="-1"></a>| median_gross_rent     | Median Gross Rent                       | Negative                    | Housing                |</span>
<span id="cb94-459"><a href="#cb94-459" aria-hidden="true" tabindex="-1"></a>| pct_hu_1<span class="sc">\_</span>detatched   | Detatched Housing Units                 | Positive                    | Housing                |</span>
<span id="cb94-460"><a href="#cb94-460" aria-hidden="true" tabindex="-1"></a>| job_density_simple    | Job Density                             | Positive                    | Employment and Economy |</span>
<span id="cb94-461"><a href="#cb94-461" aria-hidden="true" tabindex="-1"></a>| retail_density_simple | Retail Density                          | Positive                    | Employment and Economy |</span>
<span id="cb94-462"><a href="#cb94-462" aria-hidden="true" tabindex="-1"></a>| median_commute        | Median Commute Time                     | Negative                    | Transportation         |</span>
<span id="cb94-463"><a href="#cb94-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-464"><a href="#cb94-464" aria-hidden="true" tabindex="-1"></a>We are going to create an <span class="sc">\*\*</span>additive<span class="sc">\*</span> index, where standardized values are simply adde together. We can transform values so that they are moving in the same direction by simply switching the sign on values that need to be reversed (e.g. multiply by -1). Based upon the above table, Here's what that would look like:</span>
<span id="cb94-465"><a href="#cb94-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-468"><a href="#cb94-468" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-469"><a href="#cb94-469" aria-hidden="true" tabindex="-1"></a>dataset_scaled<span class="ot">&lt;-</span>dataset_scaled <span class="sc">|&gt;</span>  <span class="fu">mutate</span>(</span>
<span id="cb94-470"><a href="#cb94-470" aria-hidden="true" tabindex="-1"></a>  <span class="at">under18_scale =</span> under18_scale<span class="sc">*-</span><span class="dv">1</span>,</span>
<span id="cb94-471"><a href="#cb94-471" aria-hidden="true" tabindex="-1"></a>  <span class="at">over65_scale =</span> over65_scale<span class="sc">*-</span><span class="dv">1</span>,</span>
<span id="cb94-472"><a href="#cb94-472" aria-hidden="true" tabindex="-1"></a>  <span class="at">PNonwhite_scale =</span> PNonwhite_scale<span class="sc">*-</span><span class="dv">1</span>,</span>
<span id="cb94-473"><a href="#cb94-473" aria-hidden="true" tabindex="-1"></a>  <span class="at">PForeignborn_scale =</span> PForeignborn_scale<span class="sc">*-</span><span class="dv">1</span>,</span>
<span id="cb94-474"><a href="#cb94-474" aria-hidden="true" tabindex="-1"></a>  <span class="at">P_FHHH_scale =</span> P_FHHH_scale<span class="sc">*-</span><span class="dv">1</span>,</span>
<span id="cb94-475"><a href="#cb94-475" aria-hidden="true" tabindex="-1"></a>  <span class="at">Pov_scale =</span> Pov_scale<span class="sc">*-</span><span class="dv">1</span>,</span>
<span id="cb94-476"><a href="#cb94-476" aria-hidden="true" tabindex="-1"></a>  <span class="at">CostBurden_scale =</span> CostBurden_scale <span class="sc">*-</span><span class="dv">1</span>,</span>
<span id="cb94-477"><a href="#cb94-477" aria-hidden="true" tabindex="-1"></a>  <span class="at">CANCER_scale =</span> CANCER_scale<span class="sc">*-</span><span class="dv">1</span>,</span>
<span id="cb94-478"><a href="#cb94-478" aria-hidden="true" tabindex="-1"></a>  <span class="at">RESP_scale =</span> RESP_scale<span class="sc">*-</span><span class="dv">1</span>,</span>
<span id="cb94-479"><a href="#cb94-479" aria-hidden="true" tabindex="-1"></a>  <span class="at">PTRAF_scale =</span> PTRAF_scale<span class="sc">*-</span><span class="dv">1</span>,</span>
<span id="cb94-480"><a href="#cb94-480" aria-hidden="true" tabindex="-1"></a>  <span class="at">PM25_scale =</span> PM25_scale<span class="sc">*-</span><span class="dv">1</span>,</span>
<span id="cb94-481"><a href="#cb94-481" aria-hidden="true" tabindex="-1"></a>  <span class="at">median_gross_rent_scale =</span> median_gross_rent_scale<span class="sc">*-</span><span class="dv">1</span>,</span>
<span id="cb94-482"><a href="#cb94-482" aria-hidden="true" tabindex="-1"></a>  <span class="at">median_commute_scale =</span> median_commute_scale<span class="sc">*-</span><span class="dv">1</span></span>
<span id="cb94-483"><a href="#cb94-483" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb94-484"><a href="#cb94-484" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-485"><a href="#cb94-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-486"><a href="#cb94-486" aria-hidden="true" tabindex="-1"></a>By making these changes, once we add up our indicator values, we are essentially saying that larger values are indicative of greater opportunity and smaller values are indicative of less opportunity. Let's do two things here - we can add up all of our values to get an overall opportunity score, but let's also create sub-indicators for each category, as this may be useful information for us to observe.</span>
<span id="cb94-487"><a href="#cb94-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-488"><a href="#cb94-488" aria-hidden="true" tabindex="-1"></a>To do this, add several new variables to dataset_scaled that sum together each of the index measures by category, and then create a separate indicator that sums up those category columns into an overall opportunity measure:</span>
<span id="cb94-489"><a href="#cb94-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-490"><a href="#cb94-490" aria-hidden="true" tabindex="-1"></a>Use the following labels:</span>
<span id="cb94-491"><a href="#cb94-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-492"><a href="#cb94-492" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>dem_index = Demographic Structure</span>
<span id="cb94-493"><a href="#cb94-493" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>emp_index = Employment and Economy</span>
<span id="cb94-494"><a href="#cb94-494" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>hou_index = Housing</span>
<span id="cb94-495"><a href="#cb94-495" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>env_index = Environmental Health</span>
<span id="cb94-496"><a href="#cb94-496" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>tra_index = Transportation</span>
<span id="cb94-497"><a href="#cb94-497" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>tot_index = Combined Total Index</span>
<span id="cb94-498"><a href="#cb94-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-501"><a href="#cb94-501" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-502"><a href="#cb94-502" aria-hidden="true" tabindex="-1"></a>dataset_scaled<span class="ot">&lt;-</span>dataset_scaled <span class="sc">|&gt;</span> </span>
<span id="cb94-503"><a href="#cb94-503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb94-504"><a href="#cb94-504" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb94-505"><a href="#cb94-505" aria-hidden="true" tabindex="-1"></a>  <span class="at">dem_index =</span> <span class="fu">sum</span>(under18_scale, over65_scale, PNonwhite_scale, PForeignborn_scale, P_FHHH_scale, Pov_scale, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb94-506"><a href="#cb94-506" aria-hidden="true" tabindex="-1"></a>  <span class="at">emp_index =</span> <span class="fu">sum</span>(MHHI_scale, job_density_simple_scale, retail_density_simple_scale, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb94-507"><a href="#cb94-507" aria-hidden="true" tabindex="-1"></a>  <span class="at">hou_index =</span> <span class="fu">sum</span>(P_Own_scale, MHV_scale, CostBurden_scale, median_gross_rent_scale, pct_hu_1_detached_scale, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb94-508"><a href="#cb94-508" aria-hidden="true" tabindex="-1"></a>  <span class="at">env_index =</span> <span class="fu">sum</span>(CANCER_scale, RESP_scale, PTRAF_scale, PM25_scale, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb94-509"><a href="#cb94-509" aria-hidden="true" tabindex="-1"></a>  <span class="at">tra_index =</span> <span class="fu">sum</span>(pct_transit_j2w_scale, median_commute_scale,<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb94-510"><a href="#cb94-510" aria-hidden="true" tabindex="-1"></a>  <span class="at">tot_index =</span> dem_index <span class="sc">+</span> emp_index <span class="sc">+</span> hou_index <span class="sc">+</span> env_index <span class="sc">+</span> tra_index</span>
<span id="cb94-511"><a href="#cb94-511" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb94-512"><a href="#cb94-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-513"><a href="#cb94-513" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-514"><a href="#cb94-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-515"><a href="#cb94-515" aria-hidden="true" tabindex="-1"></a>Something's a little different here that makes a big difference. Did you notice <span class="in">`rowwise()`</span>? Typically, if we were to ask dplyr to mutate by providing a sum, it would do so by column. <span class="in">`rowwise()`</span> modifies this and asks for something to happen across a data observation (row) instead of by column. Therefore, when we ask in a mutate statement for the sum of values, we are asking R to add up the values in the same row and then insert the product into a new variable (in this case our named indexes). Pretty cool, right?</span>
<span id="cb94-516"><a href="#cb94-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-517"><a href="#cb94-517" aria-hidden="true" tabindex="-1"></a>Ok - now we have subindex values as well as a total index value. We could analyze these and interpret them as is, but there's one more thing that we might do to make these easier to interpret. Let's quickly look at some descriptive stats for our index values and think about what may be challenging for us to interpret:</span>
<span id="cb94-518"><a href="#cb94-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-521"><a href="#cb94-521" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-522"><a href="#cb94-522" aria-hidden="true" tabindex="-1"></a>dataset_scaled <span class="sc">%&gt;%</span> </span>
<span id="cb94-523"><a href="#cb94-523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dem_index, emp_index, hou_index, env_index, tra_index, tot_index) <span class="sc">%&gt;%</span> </span>
<span id="cb94-524"><a href="#cb94-524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span>
<span id="cb94-525"><a href="#cb94-525" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-526"><a href="#cb94-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-527"><a href="#cb94-527" aria-hidden="true" tabindex="-1"></a>Looking at this, there are a few challenges:</span>
<span id="cb94-528"><a href="#cb94-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-529"><a href="#cb94-529" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Since each subindex component consists of between two and six values, they end up having very different scales. This means that we can't interpret anything about the magnitude by comparing these values to each other.</span>
<span id="cb94-530"><a href="#cb94-530" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We have both positive and negative index values. Negative values don't necessarily mean anything other than that the sum of index values is negative.</span>
<span id="cb94-531"><a href="#cb94-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-532"><a href="#cb94-532" aria-hidden="true" tabindex="-1"></a>One strategy for making these values more interpretable is to **rescale** them. Do not confuse *rescaling* with the type of *standardizing* which we previously performed by converting our indicator values into z scores. Rescaling will take the data from an existing range and convert it to a new range of values.</span>
<span id="cb94-533"><a href="#cb94-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-534"><a href="#cb94-534" aria-hidden="true" tabindex="-1"></a>Rescaling converts our data from its existing range of values to a new range of values, preserving the magnitude of difference that exists between the values:</span>
<span id="cb94-535"><a href="#cb94-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-536"><a href="#cb94-536" aria-hidden="true" tabindex="-1"></a>If we want to convert our data to the range <span class="sc">\[</span>0,1<span class="sc">\]</span> here's what we'd do: $x_{rescaled} = \frac{x-min(x)}{max(x)-min(x)}$</span>
<span id="cb94-537"><a href="#cb94-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-538"><a href="#cb94-538" aria-hidden="true" tabindex="-1"></a>We can also convert our data to an arbitrary range. Let's try 0,100: $x_{rescaled} = a+\frac{x-min(x)(b-a)}{max(x) -min(x)}$</span>
<span id="cb94-539"><a href="#cb94-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-540"><a href="#cb94-540" aria-hidden="true" tabindex="-1"></a>Fortunately, R has us covered here too - the <span class="in">`rescale`</span> function in the <span class="in">`scales`</span> package will rescale to whatever range we wish:</span>
<span id="cb94-541"><a href="#cb94-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-544"><a href="#cb94-544" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-545"><a href="#cb94-545" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb94-546"><a href="#cb94-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-547"><a href="#cb94-547" aria-hidden="true" tabindex="-1"></a>dataset_scaled <span class="ot">&lt;-</span>dataset_scaled <span class="sc">|&gt;</span> </span>
<span id="cb94-548"><a href="#cb94-548" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb94-549"><a href="#cb94-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dem_index =</span> <span class="fu">rescale</span>(dem_index, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>)),</span>
<span id="cb94-550"><a href="#cb94-550" aria-hidden="true" tabindex="-1"></a>         <span class="at">emp_index =</span> <span class="fu">rescale</span>(emp_index, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>)),</span>
<span id="cb94-551"><a href="#cb94-551" aria-hidden="true" tabindex="-1"></a>         <span class="at">hou_index =</span> <span class="fu">rescale</span>(hou_index, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>)),</span>
<span id="cb94-552"><a href="#cb94-552" aria-hidden="true" tabindex="-1"></a>         <span class="at">env_index =</span> <span class="fu">rescale</span>(env_index, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>)),</span>
<span id="cb94-553"><a href="#cb94-553" aria-hidden="true" tabindex="-1"></a>         <span class="at">tra_index =</span> <span class="fu">rescale</span>(tra_index, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>)),</span>
<span id="cb94-554"><a href="#cb94-554" aria-hidden="true" tabindex="-1"></a>         <span class="at">tot_index =</span> <span class="fu">rescale</span>(tot_index, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>))</span>
<span id="cb94-555"><a href="#cb94-555" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb94-556"><a href="#cb94-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-557"><a href="#cb94-557" aria-hidden="true" tabindex="-1"></a>dataset_scaled <span class="sc">|&gt;</span>  </span>
<span id="cb94-558"><a href="#cb94-558" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dem_index, emp_index, hou_index, env_index, tra_index, tot_index) <span class="sc">|&gt;</span> </span>
<span id="cb94-559"><a href="#cb94-559" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span>
<span id="cb94-560"><a href="#cb94-560" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-561"><a href="#cb94-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-562"><a href="#cb94-562" aria-hidden="true" tabindex="-1"></a>The values are all rescaled so that the minimum is now zero and the maximum value is 100. We use <span class="in">`ungroup()`</span> here so that if we have used <span class="in">`group_by()`</span> in the past, R ignores those past groupings when we rescale. Looking at the descriptive statistics for these variables, there's still some **skew** in many cases. We might want to try visualizing these distributions so that we can better understand their implications.</span>
<span id="cb94-563"><a href="#cb94-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-564"><a href="#cb94-564" aria-hidden="true" tabindex="-1"></a><span class="fu"># Visualizing Index Values</span></span>
<span id="cb94-565"><a href="#cb94-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-568"><a href="#cb94-568" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-569"><a href="#cb94-569" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb94-570"><a href="#cb94-570" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-571"><a href="#cb94-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-572"><a href="#cb94-572" aria-hidden="true" tabindex="-1"></a>Let's start our data visualization by making a simple histogram of values for our tot_index measure:</span>
<span id="cb94-573"><a href="#cb94-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-576"><a href="#cb94-576" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-577"><a href="#cb94-577" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>tot_index))<span class="sc">+</span><span class="fu">geom_histogram</span>()</span>
<span id="cb94-578"><a href="#cb94-578" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-579"><a href="#cb94-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-580"><a href="#cb94-580" aria-hidden="true" tabindex="-1"></a>What's going on here? We call <span class="in">`ggplot`</span> (<span class="in">`ggplot()`</span>) and then start adding layers to our plot. In its most basic form, ggplot needs to know the data source, as well as some aesthetic mappings for the data. The data source can be called by name, and the aesthetic mappings are placed in <span class="in">`aes()'. After this, we can specify a format for our plot by asking it to plot using a particular geometry, in this case`</span>geom_histogram()<span class="sc">\`</span>.</span>
<span id="cb94-581"><a href="#cb94-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-582"><a href="#cb94-582" aria-hidden="true" tabindex="-1"></a>You have probably observed that ggplot tells us that it is using a somewhat arbitrary bin width for our histogram. We can select another one by adding to the histogram geometry a specification for a different number of bins:</span>
<span id="cb94-583"><a href="#cb94-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-586"><a href="#cb94-586" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-587"><a href="#cb94-587" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>tot_index))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">100</span>)</span>
<span id="cb94-588"><a href="#cb94-588" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-589"><a href="#cb94-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-590"><a href="#cb94-590" aria-hidden="true" tabindex="-1"></a>Notice, we go from 30 bins to 100 bins, meaning that they become much narrower as each captures and counts a smaller range of the data.</span>
<span id="cb94-591"><a href="#cb94-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-592"><a href="#cb94-592" aria-hidden="true" tabindex="-1"></a>We can add other elements to our plot that help to make it look nice:</span>
<span id="cb94-593"><a href="#cb94-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-596"><a href="#cb94-596" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-597"><a href="#cb94-597" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>tot_index))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">100</span>)<span class="sc">+</span></span>
<span id="cb94-598"><a href="#cb94-598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Opportunity Index: Histogram"</span>, <span class="at">x=</span><span class="st">"Opportunity Index"</span>, <span class="at">y=</span><span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb94-599"><a href="#cb94-599" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb94-600"><a href="#cb94-600" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-601"><a href="#cb94-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-602"><a href="#cb94-602" aria-hidden="true" tabindex="-1"></a>Have a look at the <span class="co">[</span><span class="ot">ggplot2 cheat sheet</span><span class="co">](https://rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf)</span> for some inspiration on how you can alter your plots further.</span>
<span id="cb94-603"><a href="#cb94-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-604"><a href="#cb94-604" aria-hidden="true" tabindex="-1"></a>Go ahead and produce similar histograms for each of the subindex components. Feel free to play around with some of the aesthetics just for fun!</span>
<span id="cb94-605"><a href="#cb94-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-608"><a href="#cb94-608" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-609"><a href="#cb94-609" aria-hidden="true" tabindex="-1"></a><span class="co"># Your Code Here</span></span>
<span id="cb94-610"><a href="#cb94-610" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>dem_index))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">100</span>)<span class="sc">+</span></span>
<span id="cb94-611"><a href="#cb94-611" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Demographic Structure Subindex: Histogram"</span>, <span class="at">x=</span><span class="st">"Opportunity Index"</span>, <span class="at">y=</span><span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb94-612"><a href="#cb94-612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb94-613"><a href="#cb94-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-614"><a href="#cb94-614" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>emp_index))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">100</span>)<span class="sc">+</span></span>
<span id="cb94-615"><a href="#cb94-615" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Employment and Economy Subindex: Histogram"</span>, <span class="at">x=</span><span class="st">"Opportunity Index"</span>, <span class="at">y=</span><span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb94-616"><a href="#cb94-616" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb94-617"><a href="#cb94-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-618"><a href="#cb94-618" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>hou_index))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">100</span>)<span class="sc">+</span></span>
<span id="cb94-619"><a href="#cb94-619" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Housing Subindex: Histogram"</span>, <span class="at">x=</span><span class="st">"Opportunity Index"</span>, <span class="at">y=</span><span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb94-620"><a href="#cb94-620" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb94-621"><a href="#cb94-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-622"><a href="#cb94-622" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>env_index))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">100</span>)<span class="sc">+</span></span>
<span id="cb94-623"><a href="#cb94-623" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Environmental Health Subindex: Histogram"</span>, <span class="at">x=</span><span class="st">"Opportunity Index"</span>, <span class="at">y=</span><span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb94-624"><a href="#cb94-624" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb94-625"><a href="#cb94-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-626"><a href="#cb94-626" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>tra_index))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">100</span>)<span class="sc">+</span></span>
<span id="cb94-627"><a href="#cb94-627" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Transportation Subindex: Histogram"</span>, <span class="at">x=</span><span class="st">"Opportunity Index"</span>, <span class="at">y=</span><span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb94-628"><a href="#cb94-628" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb94-629"><a href="#cb94-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-630"><a href="#cb94-630" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-631"><a href="#cb94-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-632"><a href="#cb94-632" aria-hidden="true" tabindex="-1"></a>Referring back to the <span class="co">[</span><span class="ot">ggplot2 cheat sheet</span><span class="co">](https://rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf)</span>, try your hand at some other one variable visualizations (good places to start would be <span class="in">`geom_area`</span>, <span class="in">`geom_density`</span>, and <span class="in">`geom_bar`</span>:</span>
<span id="cb94-633"><a href="#cb94-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-636"><a href="#cb94-636" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-637"><a href="#cb94-637" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>tra_index))<span class="sc">+</span><span class="fu">geom_area</span>(<span class="at">stat=</span><span class="st">"bin"</span>, <span class="at">bins=</span><span class="dv">100</span>)<span class="sc">+</span></span>
<span id="cb94-638"><a href="#cb94-638" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Transportation Subindex: Histogram"</span>, <span class="at">x=</span><span class="st">"Opportunity Index"</span>, <span class="at">y=</span><span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb94-639"><a href="#cb94-639" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb94-640"><a href="#cb94-640" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-641"><a href="#cb94-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-642"><a href="#cb94-642" aria-hidden="true" tabindex="-1"></a><span class="fu"># Demographics by Opportunity Levels</span></span>
<span id="cb94-643"><a href="#cb94-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-644"><a href="#cb94-644" aria-hidden="true" tabindex="-1"></a>Let's take a look at our overall opportunity index again:</span>
<span id="cb94-645"><a href="#cb94-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-648"><a href="#cb94-648" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-649"><a href="#cb94-649" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>tot_index))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">100</span>)<span class="sc">+</span></span>
<span id="cb94-650"><a href="#cb94-650" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Opportunity Index: Histogram"</span>, <span class="at">x=</span><span class="st">"Opportunity Index"</span>, <span class="at">y=</span><span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb94-651"><a href="#cb94-651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb94-652"><a href="#cb94-652" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-653"><a href="#cb94-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-654"><a href="#cb94-654" aria-hidden="true" tabindex="-1"></a>How might we start to think about some of the demographic correlates of who lives in places with higher aggregate opportunity and lower aggregate opportunity? You'll recall from when we initially created our index that we had downloaded some information on race and ethnicity which was not incorporated into our opportunity measures. We might be interested to see how our composite measure of low and high opportunity are related to the racial and ethnic composition of the census tracts they are from.</span>
<span id="cb94-655"><a href="#cb94-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-656"><a href="#cb94-656" aria-hidden="true" tabindex="-1"></a>We might turn towards a some bivariate visualizations to help us here. Let's start with a simple scatterplot:</span>
<span id="cb94-657"><a href="#cb94-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-660"><a href="#cb94-660" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-661"><a href="#cb94-661" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PWhite, <span class="at">y =</span>tot_index))<span class="sc">+</span><span class="fu">geom_point</span>()</span>
<span id="cb94-662"><a href="#cb94-662" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-663"><a href="#cb94-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-664"><a href="#cb94-664" aria-hidden="true" tabindex="-1"></a>How would you describe the relationship visualized here (note that I shifted the index values to the y scale and placed percent white on the x scale)? To make it easier, let's add another geometry to the same plot, in this case, by fitting a line to our data:</span>
<span id="cb94-665"><a href="#cb94-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-668"><a href="#cb94-668" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-669"><a href="#cb94-669" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PWhite, <span class="at">y =</span>tot_index))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span>
<span id="cb94-670"><a href="#cb94-670" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-671"><a href="#cb94-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-672"><a href="#cb94-672" aria-hidden="true" tabindex="-1"></a>How would you describe the relationship between the tract-level concentration of the white population and the overall index score?</span>
<span id="cb94-673"><a href="#cb94-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-674"><a href="#cb94-674" aria-hidden="true" tabindex="-1"></a>We might want to polish things up a little more - here are some suggested additions to think about.</span>
<span id="cb94-675"><a href="#cb94-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-678"><a href="#cb94-678" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-679"><a href="#cb94-679" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PWhite, <span class="at">y =</span>tot_index))<span class="sc">+</span></span>
<span id="cb94-680"><a href="#cb94-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">6</span>, <span class="at">cex =</span> .<span class="dv">75</span>)<span class="sc">+</span> <span class="co"># Use alpha to control the transparency of the points and cex to control their size</span></span>
<span id="cb94-681"><a href="#cb94-681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb94-682"><a href="#cb94-682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"White (%)"</span>, <span class="at">y =</span> <span class="st">"Combined Opportunity Index"</span>)<span class="sc">+</span> <span class="co"># Add labels to the x and y axes</span></span>
<span id="cb94-683"><a href="#cb94-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent)<span class="sc">+</span> <span class="co"># Use the scales package to convert X-axis to percentages</span></span>
<span id="cb94-684"><a href="#cb94-684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="co">#Use themes to eliminate extra shading on plots</span></span>
<span id="cb94-685"><a href="#cb94-685" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-686"><a href="#cb94-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-687"><a href="#cb94-687" aria-hidden="true" tabindex="-1"></a>Your turn - produce similar plots for the Black, Asian, and Latino populations:</span>
<span id="cb94-688"><a href="#cb94-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-691"><a href="#cb94-691" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-692"><a href="#cb94-692" aria-hidden="true" tabindex="-1"></a><span class="co"># Your Work Here</span></span>
<span id="cb94-693"><a href="#cb94-693" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PBlack, <span class="at">y =</span>tot_index))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span>
<span id="cb94-694"><a href="#cb94-694" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PAsian, <span class="at">y =</span>tot_index))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span>
<span id="cb94-695"><a href="#cb94-695" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PLatino, <span class="at">y =</span>tot_index))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span>
<span id="cb94-696"><a href="#cb94-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-697"><a href="#cb94-697" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-698"><a href="#cb94-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-699"><a href="#cb94-699" aria-hidden="true" tabindex="-1"></a><span class="fu"># How different are counties in the region?</span></span>
<span id="cb94-700"><a href="#cb94-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-701"><a href="#cb94-701" aria-hidden="true" tabindex="-1"></a>So far, we've been looking at opportunity scores for the New York City. The values we see are likely to be very different for different boroughs. Let's disaggregate and make some comparisons.</span>
<span id="cb94-702"><a href="#cb94-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-703"><a href="#cb94-703" aria-hidden="true" tabindex="-1"></a>As a reminder, here are the county FIPS codes for the boroughs in the city:</span>
<span id="cb94-704"><a href="#cb94-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-705"><a href="#cb94-705" aria-hidden="true" tabindex="-1"></a>| FIPS Code | County Name     | Borough Name  |</span>
<span id="cb94-706"><a href="#cb94-706" aria-hidden="true" tabindex="-1"></a>|-----------|-----------------|---------------|</span>
<span id="cb94-707"><a href="#cb94-707" aria-hidden="true" tabindex="-1"></a>| 36047     | Kings County    | Brooklyn      |</span>
<span id="cb94-708"><a href="#cb94-708" aria-hidden="true" tabindex="-1"></a>| 36005     | Bronx County    | Bronx         |</span>
<span id="cb94-709"><a href="#cb94-709" aria-hidden="true" tabindex="-1"></a>| 36081     | Queens County   | Queens        |</span>
<span id="cb94-710"><a href="#cb94-710" aria-hidden="true" tabindex="-1"></a>| 36085     | Richmond County | Staten Island |</span>
<span id="cb94-711"><a href="#cb94-711" aria-hidden="true" tabindex="-1"></a>| 36061     | New York County | Manhattan     |</span>
<span id="cb94-712"><a href="#cb94-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-713"><a href="#cb94-713" aria-hidden="true" tabindex="-1"></a>Let's label each tract by the borough (county) that contains it.</span>
<span id="cb94-714"><a href="#cb94-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-715"><a href="#cb94-715" aria-hidden="true" tabindex="-1"></a>We used <span class="in">`case_when()`</span> in the past. <span class="in">`case_when()`</span> allows us to set up multiple conditions to search for, and then we can determine what to do when we have found records which match that condition:</span>
<span id="cb94-716"><a href="#cb94-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-719"><a href="#cb94-719" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-720"><a href="#cb94-720" aria-hidden="true" tabindex="-1"></a>dataset_scaled<span class="ot">&lt;-</span>dataset_scaled <span class="sc">|&gt;</span> </span>
<span id="cb94-721"><a href="#cb94-721" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">location =</span> <span class="fu">case_when</span>(</span>
<span id="cb94-722"><a href="#cb94-722" aria-hidden="true" tabindex="-1"></a>  <span class="fu">substr</span>(GEOID, <span class="dv">0</span>,<span class="dv">5</span>) <span class="sc">==</span> <span class="st">"36047"</span> <span class="sc">~</span> <span class="st">"Brooklyn"</span>,</span>
<span id="cb94-723"><a href="#cb94-723" aria-hidden="true" tabindex="-1"></a>  <span class="fu">substr</span>(GEOID, <span class="dv">0</span>,<span class="dv">5</span>) <span class="sc">==</span> <span class="st">"36005"</span> <span class="sc">~</span> <span class="st">"Bronx"</span>,</span>
<span id="cb94-724"><a href="#cb94-724" aria-hidden="true" tabindex="-1"></a>  <span class="fu">substr</span>(GEOID, <span class="dv">0</span>,<span class="dv">5</span>) <span class="sc">==</span> <span class="st">"36081"</span> <span class="sc">~</span> <span class="st">"Queens"</span>,</span>
<span id="cb94-725"><a href="#cb94-725" aria-hidden="true" tabindex="-1"></a>  <span class="fu">substr</span>(GEOID, <span class="dv">0</span>,<span class="dv">5</span>) <span class="sc">==</span> <span class="st">"36085"</span> <span class="sc">~</span> <span class="st">"Staten Island"</span>,</span>
<span id="cb94-726"><a href="#cb94-726" aria-hidden="true" tabindex="-1"></a>  <span class="fu">substr</span>(GEOID, <span class="dv">0</span>,<span class="dv">5</span>) <span class="sc">==</span> <span class="st">"36061"</span> <span class="sc">~</span> <span class="st">"Manhattan"</span></span>
<span id="cb94-727"><a href="#cb94-727" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb94-728"><a href="#cb94-728" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-729"><a href="#cb94-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-730"><a href="#cb94-730" aria-hidden="true" tabindex="-1"></a>In this case, we create a new variable called location, and then label those records where the county FIPS code is equal to a particular county.</span>
<span id="cb94-731"><a href="#cb94-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-732"><a href="#cb94-732" aria-hidden="true" tabindex="-1"></a>Now that we have this new differentiating variable, we can modify our existing plots to illustrate differences between boroughs. We can start by **faceting** our existing chart. Facets take categorical variables and split the chart into as many multiples as there are categories. In our case, we can use our new location variable as a facet, so we should expect five multiples in an updated chart:</span>
<span id="cb94-733"><a href="#cb94-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-736"><a href="#cb94-736" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-737"><a href="#cb94-737" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>tot_index))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">100</span>)<span class="sc">+</span></span>
<span id="cb94-738"><a href="#cb94-738" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Opportunity Index: Histogram"</span>, <span class="at">x=</span><span class="st">"Opportunity Index"</span>, <span class="at">y=</span><span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb94-739"><a href="#cb94-739" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb94-740"><a href="#cb94-740" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>location)</span>
<span id="cb94-741"><a href="#cb94-741" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-742"><a href="#cb94-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-743"><a href="#cb94-743" aria-hidden="true" tabindex="-1"></a>The tilde (<span class="in">`~`</span>) is necessary before listing the variable you want to facet.</span>
<span id="cb94-744"><a href="#cb94-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-745"><a href="#cb94-745" aria-hidden="true" tabindex="-1"></a>This gives us a sense of the relative shape and distribution of opportunity index values for each county. As an alternative strategy to use our facets, we might want to set our scales to "free" in our histogram settings so that we can better compare the shape of our histograms. The distortion we see is due to Brooklyn and Queens having more tracts, thereby creating higher peaks within any given bin. By setting scales to "free", ggplot sets the scales based upon the range of data contained only within a given facet instead of across all facets:</span>
<span id="cb94-746"><a href="#cb94-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-749"><a href="#cb94-749" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-750"><a href="#cb94-750" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>tot_index))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">100</span>)<span class="sc">+</span></span>
<span id="cb94-751"><a href="#cb94-751" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Opportunity Index: Histogram"</span>, <span class="at">x=</span><span class="st">"Opportunity Index"</span>, <span class="at">y=</span><span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb94-752"><a href="#cb94-752" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb94-753"><a href="#cb94-753" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>location, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb94-754"><a href="#cb94-754" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-755"><a href="#cb94-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-756"><a href="#cb94-756" aria-hidden="true" tabindex="-1"></a>What can this tell us about the distribution of opportunity scores within each borough in New York City?</span>
<span id="cb94-757"><a href="#cb94-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-758"><a href="#cb94-758" aria-hidden="true" tabindex="-1"></a>Now go ahead and re-create the scatterplot we previously created that compared the White population on the x axis to the overall opportunity index score on the y axis. Be sure to facet by location. Go ahead and add a summary line of best fit as well.</span>
<span id="cb94-759"><a href="#cb94-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-762"><a href="#cb94-762" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-763"><a href="#cb94-763" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PWhite, <span class="at">y =</span>tot_index))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb94-764"><a href="#cb94-764" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>location)<span class="sc">+</span></span>
<span id="cb94-765"><a href="#cb94-765" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb94-766"><a href="#cb94-766" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-767"><a href="#cb94-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-768"><a href="#cb94-768" aria-hidden="true" tabindex="-1"></a>Let's try faceting subindex values to see how they differ. Are there any that you can see any substantial visual differences on? How would you explain the differences that you see?</span>
<span id="cb94-769"><a href="#cb94-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-772"><a href="#cb94-772" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-773"><a href="#cb94-773" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PWhite, <span class="at">y =</span>dem_index))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb94-774"><a href="#cb94-774" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>location)</span>
<span id="cb94-775"><a href="#cb94-775" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PWhite, <span class="at">y =</span>emp_index))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb94-776"><a href="#cb94-776" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>location)</span>
<span id="cb94-777"><a href="#cb94-777" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PWhite, <span class="at">y =</span>hou_index))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb94-778"><a href="#cb94-778" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>location)</span>
<span id="cb94-779"><a href="#cb94-779" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PWhite, <span class="at">y =</span>env_index))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb94-780"><a href="#cb94-780" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>location)</span>
<span id="cb94-781"><a href="#cb94-781" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PWhite, <span class="at">y =</span>tra_index))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb94-782"><a href="#cb94-782" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>location)</span>
<span id="cb94-783"><a href="#cb94-783" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-784"><a href="#cb94-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-785"><a href="#cb94-785" aria-hidden="true" tabindex="-1"></a>So far, we have learned how to display fit regression lines on top of our point data. Sometimes, it can be useful to simply display those lines without the associated point data. As part of our aesthetic mapping, we can set a grouping variable (group), and also tell ggplot to vary the colour (British spelling, please) of each group. In this case, we set both of these based upon the location variable:</span>
<span id="cb94-786"><a href="#cb94-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-789"><a href="#cb94-789" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-790"><a href="#cb94-790" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PWhite, <span class="at">y =</span>tot_index, <span class="at">group=</span>location, <span class="at">colour=</span>location))<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb94-791"><a href="#cb94-791" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb94-792"><a href="#cb94-792" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-793"><a href="#cb94-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-794"><a href="#cb94-794" aria-hidden="true" tabindex="-1"></a>How would you interpret the differences between the two lines (without points)? Can you re-create similar graphics for some of the subindex categories or other racial identifications?</span>
<span id="cb94-795"><a href="#cb94-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-796"><a href="#cb94-796" aria-hidden="true" tabindex="-1"></a>Finally, let's combine some of what we've learned here to visualize groups for both the point data and the associated regression lines:</span>
<span id="cb94-797"><a href="#cb94-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-800"><a href="#cb94-800" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-801"><a href="#cb94-801" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dataset_scaled, <span class="fu">aes</span>(<span class="at">x=</span>PWhite, <span class="at">y =</span>tot_index, <span class="at">group=</span>location, <span class="at">colour=</span>location))<span class="sc">+</span></span>
<span id="cb94-802"><a href="#cb94-802" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span>.<span class="dv">075</span>)<span class="sc">+</span></span>
<span id="cb94-803"><a href="#cb94-803" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">alpha =</span> .<span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb94-804"><a href="#cb94-804" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"White Population (%)"</span>, <span class="at">y =</span> <span class="st">"Opportunity Index"</span>, <span class="at">colour =</span> <span class="st">"County"</span>)<span class="sc">+</span></span>
<span id="cb94-805"><a href="#cb94-805" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent)<span class="sc">+</span></span>
<span id="cb94-806"><a href="#cb94-806" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb94-807"><a href="#cb94-807" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-808"><a href="#cb94-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-809"><a href="#cb94-809" aria-hidden="true" tabindex="-1"></a>I have used <span class="in">`theme_classic()`</span> here to remove the gray background which I think makes it difficult to see the points and lines well. In the point geometries, I have used the *alpha* value to alter the transparency of the points. This can help us to see some of the differences between boroughs. If you look carefully, you'll also see that there is a rather dense cluster of tracts that are mostly non-white with relatively high opportunity scores in Queens. In this chart, we can also see how those tracts with a high proportion of white people and high index values are what is likely bringing up the slope of the regression line for the total index.</span>
<span id="cb94-810"><a href="#cb94-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-811"><a href="#cb94-811" aria-hidden="true" tabindex="-1"></a>Spend some time playing around with these visualizations using different aesthetic mappings and different x and y variables. Think about how you can creatively layer different components and also about the types of stories that you can tell about opportunity in Illinois.</span>
<span id="cb94-812"><a href="#cb94-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-813"><a href="#cb94-813" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extending your Analysis</span></span>
<span id="cb94-814"><a href="#cb94-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-815"><a href="#cb94-815" aria-hidden="true" tabindex="-1"></a>The most standard next step in opportunity mapping is...</span>
<span id="cb94-816"><a href="#cb94-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-817"><a href="#cb94-817" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Making a map. Drawing from your index data, make a map of your overall index score for your place or region, as well as for index sub-components. What spatial patterns emerge? Map out key demographic information - how do these seem to be related to your overall measures of opportunity?</span>
<span id="cb94-818"><a href="#cb94-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-819"><a href="#cb94-819" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb94-820"><a href="#cb94-820" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;!-- --&gt;</span></span>
<span id="cb94-821"><a href="#cb94-821" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-822"><a href="#cb94-822" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Create summary visualizations and tables that display where the highest and lowest levels of opportunity are within the region? Who lives in these places?</span>
<span id="cb94-823"><a href="#cb94-823" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Consider connecting your opportunity indexes to other data (examples might include public health statistics, transportation costs, presence of public or subsidized housing, etc.) How does a multidimensional opportunity index help you tell stories about these places?</span>
<span id="cb94-824"><a href="#cb94-824" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Create a journalistic narrative about opportunity in your place or for another region. What makes your story powerful, and what story is it telling?</span>
<span id="cb94-825"><a href="#cb94-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-826"><a href="#cb94-826" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lab Evaluation</span></span>
<span id="cb94-827"><a href="#cb94-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-828"><a href="#cb94-828" aria-hidden="true" tabindex="-1"></a>In evaluating your lab submission, we'll be paying attention to the following:</span>
<span id="cb94-829"><a href="#cb94-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-830"><a href="#cb94-830" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>A demonstrated conceptual understanding of the opportunity concept and the way it becomes operationalized with quantitative demographic data.</span>
<span id="cb94-831"><a href="#cb94-831" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Correct re-deployment of the code based used in this lab for your own place or region.</span>
<span id="cb94-832"><a href="#cb94-832" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>A clear narrative analysis of opportunity for your place.</span>
<span id="cb94-833"><a href="#cb94-833" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Proper formatting of tables, figures, and visualizations.</span>
<span id="cb94-834"><a href="#cb94-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-835"><a href="#cb94-835" aria-hidden="true" tabindex="-1"></a>As you get into the lab, please feel welcome to ask us questions, and please share where you're struggling with us and with others in the class.</span>
<span id="cb94-836"><a href="#cb94-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-837"><a href="#cb94-837" aria-hidden="true" tabindex="-1"></a><span class="fu">## References</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Content <i class="fa-regular fa-copyright" aria-label="copyright"></i> Andrew J. Greenlee</div>   
    <div class="nav-footer-right">Made with <i class="fa-brands fa-r-project" aria-label="r-project"></i> and <a href="https://quarto.org/">Quarto</a> <br> Website Code on <a href="https://github.com/agreen4/UP570_S23_Website">Github <i class="fa-brands fa-github" aria-label="github"></i></a></div>
  </div>
</footer>



</body></html>